<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>networking-book</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./mdbook-admonish.css">
        <link rel="stylesheet" href="./theme/catppuccin.css">
        <link rel="stylesheet" href="./theme/catppuccin-highlight.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="preface.html">Preface</a></li><li class="chapter-item expanded affix "><a href="osi-model.html">OSI model</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Topology</li><li class="chapter-item expanded "><a href="cloud-topology.html">Cloud</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Layer 7: Application</li><li class="chapter-item expanded "><a href="layer-7/index.html">Overview</a></li><li class="chapter-item expanded "><a href="layer-7/http.html">HTTP</a></li><li><ol class="section"><li class="chapter-item expanded "><div>Browser</div></li></ol></li><li class="chapter-item expanded "><a href="layer-7/http-another.html">HTTP</a></li><li class="chapter-item expanded "><a href="layer-7/https.html">HTTPS</a></li><li class="chapter-item expanded "><a href="layer-7/ssh.html">SSH</a></li><li class="chapter-item expanded "><a href="layer-7/ssl.html">SSL/TLS</a></li><li class="chapter-item expanded "><a href="layer-7/dns.html">DNS</a></li><li class="chapter-item expanded "><a href="layer-7/telnet.html">Telnet</a></li><li class="chapter-item expanded "><a href="layer-7/websocket.html">WebSocket</a></li><li class="chapter-item expanded "><a href="layer-7/bgp.html">BGP</a></li><li class="chapter-item expanded "><a href="layer-7/dhcp.html">DHCP</a></li><li class="chapter-item expanded "><a href="layer-7/pop-imap.html">POP, IMAP</a></li><li class="chapter-item expanded "><a href="layer-7/smtp.html">SMTP</a></li><li class="chapter-item expanded "><div>SFTP</div></li><li class="chapter-item expanded "><div>BitTorrent</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Layer 4: Transport</li><li class="chapter-item expanded "><a href="layer-4/transport-layer.html">Overview</a></li><li class="chapter-item expanded "><a href="layer-4/tcp.html">TCP</a></li><li class="chapter-item expanded "><a href="layer-4/udp.html">UDP</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Layer 3: Network (Internet)</li><li class="chapter-item expanded "><a href="layer-3/network-layer.html">Overview</a></li><li class="chapter-item expanded "><a href="layer-3/ipv4.html">IP</a></li><li class="chapter-item expanded "><a href="layer-3/icmp.html">ICMP</a></li><li class="chapter-item expanded "><a href="layer-3/ipsec.html">IPSec</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Layer 1: Physical/Datalink</li><li class="chapter-item expanded "><a href="layer-1/index.html">Overview</a></li><li class="chapter-item expanded "><a href="layer-1/arp.html">ARP</a></li><li class="chapter-item expanded "><div>802.11 WiFi</div></li><li class="chapter-item expanded "><div>802.3 Ethernet</div></li><li class="spacer"></li><li class="chapter-item expanded "><a href="standards.html">Standards</a></li><li class="chapter-item expanded "><div>Tings</div></li><li><ol class="section"><li class="chapter-item expanded "><div>Gateway</div></li><li class="chapter-item expanded "><div>Router</div></li><li class="chapter-item expanded "><a href="access-networks.html">Access networks</a></li><li class="chapter-item expanded "><div>NAT</div></li><li class="chapter-item expanded "><div>NIC</div></li><li class="chapter-item expanded "><a href="socket.html">Socket</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Network architectures</li><li class="chapter-item expanded "><div>Client-server</div></li><li class="chapter-item expanded "><div>P2P</div></li><li class="chapter-item expanded "><div>Hybrid</div></li><li class="chapter-item expanded "><div>Data centres</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">What happens when you</li><li class="chapter-item expanded "><a href="what-happens.html">Type a URL on the browser</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="troubleshooting.html">Troubleshooting</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frapp√©</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">networking-book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="preface"><a class="header" href="#preface">Preface</a></h1>
<ul>
<li>http://flashcards.wizardzines.com</li>
<li>https://jvns.ca/networking-zine.pdf</li>
</ul>
<p>(jvns‚Äôs network zines)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osi-model"><a class="header" href="#osi-model">OSI model</a></h1>
<p>OSI model vs. TCP/IP model</p>
<p><img src="./tcp-ip.png" alt="TCP/IP model" />
<img src="./tcp-ip-2.png" alt="TCP/IP model" />
<img src="./tcp-ip-3.png" alt="TCP/IP model" /></p>
<div class="table-wrapper"><table><thead><tr><th>TCP/IP layer</th><th>OSI layers</th><th>Data</th><th>Concepts</th><th>Protocols</th><th>Where</th></tr></thead><tbody>
<tr><td>Layer 4  Application</td><td>5,6,7</td><td>User data like email, webpage</td><td></td><td>HTTP, SSH, WebSocket, DNS, TLS, Telnet, DHCP, IMAP, POP, SMTP, BGP</td><td></td></tr>
<tr><td>Layer 3  Transport</td><td>4</td><td>Source &amp; dest port, ACK Checksum‚Äî(above)</td><td>Ensure successful and reliable delivery. Requires syncing up with recipient. Segments the data. Ports. Sessions. Stream sockets.</td><td>TCP, UDP</td><td>OS kernel, system libraries</td></tr>
<tr><td>Layer 2  Internet</td><td>3</td><td>Source &amp; dest IP addr‚Äî(above)</td><td>Routing, addressing, subnetting, packets</td><td>IP, ICMP</td><td>OS kernel, routers</td></tr>
<tr><td>Layer 1  Network access/link</td><td>1,2</td><td></td><td>Handles physical infrastructure and conversion digital data to signals.</td><td>Ethernet, Wi-Fi, MAC</td><td>Device drivers</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="cloud"><a class="header" href="#cloud">Cloud</a></h1>
<p><img src="./cloud-topology.png" alt="Cloud topology" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="layer-7---application"><a class="header" href="#layer-7---application">Layer 7 - Application</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="http"><a class="header" href="#http">HTTP</a></h1>
<p><strong>Cookie</strong></p>
<p>Cookies are unique string identifiers that can be stored on the client‚Äôs browser to keep track of client‚Äôs state (for the purpose of logging in, serving customised content). They are set by the server through HTTP headers. After the cookie is set, it‚Äôs sent along with subsequent HTTP requests to the same server to allow the server to know who is contacting it.</p>
<p>Things involved in the process of setting and using cookies: HTTP request, HTTP response, cookie file on the client‚Äôs browser and the database of cookie-user values on the server</p>
<p>Cookie file contains:</p>
<ul>
<li>Website‚Äôs domain</li>
<li>String value of cookie</li>
<li>Date that cookie expires</li>
</ul>
<p>Set cookie: session=44ecb091; path=/servlets</p>
<p>Note: 3rd party cookies are cookies set for domains that are not being visited. Blocking them is not enough due to several workarounds like respawning cookies etc.</p>
<p>Safari: Preferences &gt; Privacy</p>
<p>Chrome: DevTools &gt; Application &gt; Storage &gt; Cookies</p>
<h1 id="http-clients"><a class="header" href="#http-clients">HTTP clients</a></h1>
<p>browser, cURL, postman, XMLHTTPRequest API, Fetch API</p>
<h1 id="reliance-on-tcp"><a class="header" href="#reliance-on-tcp"><strong>Reliance on TCP</strong></a></h1>
<p>HTTP uses TCP as its underlying transport protocol so that messages are guaranteed to get delivered in order. A connection must first be made.</p>
<h1 id="http-status-codes"><a class="header" href="#http-status-codes"><strong>HTTP status codes</strong></a></h1>
<ul>
<li>200 OK - request successfully processed</li>
<li>301 - moved permanently</li>
<li>403 Forbidden - server denied access to resource</li>
<li>400 Bad Request - request is malformed</li>
<li>401 Unauthorised - request requires authentication</li>
<li>404 Not Found - resource is invalid and does not exist on the server</li>
<li>500 Internal Server Error</li>
<li>503 Service Unavailable - server overloaded or internal system of server has faile</li>
</ul>
<h2 id="content-security-policy"><a class="header" href="#content-security-policy">Content Security Policy</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="http-1"><a class="header" href="#http-1">HTTP</a></h1>
<p>HyperText Text Transfer Protocol.</p>
<p>HTTP is a client-server application layer protocol.</p>
<p>HTTP is a request-response protocol that defines format of messages to be exchanged between web clients and web servers. It is a stateless protocol in which no session information is retained by the server. This means that if a client requests the same object multiple times in a row, the serve would send it and would not know that the same client is requesting the same object repeatedly.</p>
<hr />
<p><img src="layer-7/./http1.png" alt="HTTP request headers" /></p>
<p><img src="layer-7/./http2.png" alt="HTTP response headers" /></p>
<hr />
<p>‚ÄúPayload‚Äù = part of transmitted data that is the actual intended message.</p>
<h1 id="types-of-http-connections"><a class="header" href="#types-of-http-connections"><strong>Types of HTTP connections</strong></a></h1>
<ul>
<li>
<p>Non-persistent HTTP connections</p>
<ol>
<li>The client initiates a TCP connection with a server.</li>
<li>The client sends an HTTP request to the server.</li>
<li>The server retrieves the requested resource from its storage etc. and sends it back to the client.</li>
<li>THe client receives the resource, say an HTML. If that file has references to more resources, steps 1-4 are repeated for each of those.</li>
<li>The server closes the TCP connection.</li>
</ol>
</li>
<li>
<p>Persistent HTTP connections</p>
<p>Because an HTTP session typically involves multiple non-persistent HTTP connections, the TCP connections which are established and torn down multiple times are inefficient. Persistent HTTP connections are developed such that the duration of the time before the server closes the connection is configurable. Hence, only 1 TCP connection is used to serve multiple requests.</p>
</li>
</ul>
<h1 id="http-session"><a class="header" href="#http-session"><strong>HTTP session</strong></a></h1>
<p>An HTTP session is a sequence of network request-response transactions.</p>
<ol>
<li>An HTTP client initiates a request by establishing a TCP connection to a particular port on the HTTP server.</li>
<li>The HTTP server listening on that port waits for a client‚Äôs request message.</li>
<li>Upon receiving the request, the server sends back a status line and a message.</li>
</ol>
<h1 id="http-messages"><a class="header" href="#http-messages"><strong>HTTP messages</strong></a></h1>
<p><strong>HTTP messages are in plain ASCII text</strong></p>
<ul>
<li>
<p>Request</p>
<pre><code>GET /index.html HTTP/1.1    Request line (method, URL, version)
Host: www.google.com        Header line
Connection: keep-alive      Header line
User-Agent: Mozilla/5.0     Header line
Accept-language: fr.        Header line
Accept: text/html           Header line
\r\n

Other headers:
Cookie: value
</code></pre>
</li>
<li>
<p>Response</p>
<pre><code>HTTP/1.1 200 OK             Status
Connection: close           Header line
Date: Tue, 18 Aug 2020 ...  Header line (date of response)
Server: www.google.com      Header line
Last-Modified: ...          Header line (date object last mod)
Content-Length: 16824       Header line (bytes)
Content-Type: text/html     Header line
\n
&lt;binary data&gt;               Object

Other headers:
Set-cookie: value
</code></pre>
</li>
<li>
<p>Route/path</p>
</li>
<li>
<p>query parameter</p>
</li>
<li>
<p>Body</p>
<ul>
<li>JSON</li>
<li>
<h2 id="form-fields"><a class="header" href="#form-fields">Form fields</a></h2>
</li>
</ul>
</li>
<li>
<p>Header</p>
</li>
</ul>
<h2 id="content-types-encoding"><a class="header" href="#content-types-encoding">Content types (encoding)</a></h2>
<p><code>application/x-www-form-urlencoded</code> (POST)</p>
<p>Normal</p>
<pre><code>POST /test HTTP/1.1
Host: foo.example
Content-Type: application/x-www-form-urlencoded
Content-Length: 27

field1=value1&amp;field2=value2
</code></pre>
<p><code>multipart/form-data</code> (POST)</p>
<p>When there are files</p>
<pre><code>POST /test HTTP/1.1 
Host: foo.example
Content-Type: multipart/form-data;boundary=&quot;boundary&quot; 

--boundary 
Content-Disposition: form-data; name=&quot;field1&quot; 

value1 
--boundary 
Content-Disposition: form-data; name=&quot;field2&quot;; filename=&quot;example.txt&quot; 

value2
--boundary--
</code></pre>
<p><code>text/plain</code> (POST)</p>
<h1 id="http-methods"><a class="header" href="#http-methods">HTTP methods</a></h1>
<ul>
<li>
<p>GET - fetch an existing resource</p>
</li>
<li>
<p>POST - create a new resource</p>
</li>
<li>
<p>HEAD - fetch HTTP headers sent</p>
</li>
<li>
<p>DELETE - delete an existing resource</p>
</li>
<li>
<p>PUT - update an existing resource</p>
</li>
<li>
<p>OPTIONS</p>
<pre><code class="language-bash">curl -X OPTIONS https://google.com -i
</code></pre>
<ul>
<li>Identify allowed request methods (eg. GET etc.). Response contains an <code>Allow</code> header.</li>
<li>Preflighted requests in CORS</li>
</ul>
</li>
</ul>
<h1 id="http-headers"><a class="header" href="#http-headers">HTTP headers</a></h1>
<p>(basic)</p>
<ul>
<li>
<p><strong>Date</strong>: Sat, 03 Jul 2021 07:23:23 GMT</p>
</li>
<li>
<p><strong>Server</strong>: nginx</p>
</li>
<li>
<p><strong>Content-Length</strong>: 1125</p>
<p>Entity's body size (bytes)</p>
</li>
<li>
<p><strong>Content-Type</strong>: text/html; charset=utf-8</p>
<p>Resource's media type</p>
</li>
</ul>
<p>(security)</p>
<ul>
<li>
<p><strong>Strict-Transport-Security</strong>: max-age=31536000; includeSubDomains</p>
<p>Tell a browser you should only load the website in HTTPS. Here is one year.</p>
</li>
<li>
<p><strong>Content-Security-Policy</strong>: ****default-src 'self'; ****style-src 'self'; ****script-src 'self'; object-src 'self'; connect-src 'self'; frame-src 'self'; image-src 'self'</p>
<p>Whether to load assets (eg. documents, CSS, images, JavaScript)</p>
<aside>
  üö® XSS, data injection
</aside>
<p>https://report-uri.com/home/analyse/</p>
<p>There's a <strong>Content-Security-Policy-Report-Only</strong> header for debugging purposes.</p>
</li>
<li>
<p><strong>X-Frame-Options</strong>: {DENY, SAMEORIGIN, ALLOW-FROM https://example.com}</p>
<p>Whether to allow your website to be <em>framed</em> or not.</p>
<aside>
  üö® Clickjacking
</aside>
</li>
<li>
<p><strong>X-Content-Type-Options</strong>: nosniff</p>
<p>Whether the browser can <em>MIME-sniff</em> the resource. MIME-sniffing happens (for some web browsers) to determine the content of an asset. Specific to IE and Chrome. With clever naming, a resource can be determined to be an HTML document which has malicious script.</p>
<aside>
  üö® XSS
</aside>
</li>
<li>
<p><strong>Referrer-Policy</strong>: no-referrer</p>
<p>Tell the browser how much information to put in this header when navigating away from the document.</p>
<aside>
  üö® Privacy
</aside>
</li>
</ul>
<p>(new)</p>
<ul>
<li><strong>X-Processing-Time:</strong> 0.061</li>
</ul>
<p><a href="https://securityheaders.com/">https://securityheaders.com</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="https"><a class="header" href="#https">HTTPS</a></h1>
<p><a href="https://howhttps.works/">https://howhttps.works</a></p>
<ul>
<li>Authenticity</li>
<li>Confidentiality or privacy</li>
<li>Integrity</li>
</ul>
<h1 id="1-server"><a class="header" href="#1-server">1. Server</a></h1>
<ol>
<li>Generate private key</li>
<li>Use private key to generate CSR. Includes info like
<ol>
<li><strong>Website‚Äôs URL</strong></li>
<li>public key (gotten from private key)</li>
<li>Company details</li>
<li>Country</li>
</ol>
</li>
</ol>
<p>https://www.namecheap.com/support/knowledgebase/article.aspx/9592/14/generating-a-csr-on-amazon-web-services-aws/</p>
<h1 id="2-sectigo-via-namecheap"><a class="header" href="#2-sectigo-via-namecheap">2. Sectigo (via Namecheap)</a></h1>
<ol>
<li>Enter CSR code</li>
<li>Confirm that you own the domain (DCV)https://www.namecheap.com/support/knowledgebase/article.aspx/9637/68/how-can-i-complete-the-domain-control-validation-dcv-for-my-ssl-certificate/?_ga=2.260912141.1610096874.1622123522-993745155.1616320593</li>
<li>Receive the SSL cert in email. SSL cert contains info like:
<ol>
<li>The website‚Äôs URL</li>
<li><strong>Public key (from the private key that we generated)</strong></li>
<li>Certificate authority (certificate issuer)</li>
<li>Expiry date</li>
</ol>
</li>
</ol>
<h1 id="3-server"><a class="header" href="#3-server">3. Server</a></h1>
<ol>
<li>Concatenate all certs that you have (???)</li>
<li>Run server and specify cert and private_key</li>
</ol>
<h1 id="4-browser"><a class="header" href="#4-browser">4. Browser</a></h1>
<p><img src="layer-7/./https.png" alt="HTTPS" /></p>
<ol>
<li>Browser visits an https website</li>
<li>Server replies</li>
<li>Server sends back a cert</li>
<li>Server key exchange, server gives client public key</li>
<li>
<ul>
<li></li>
</ul>
</li>
</ol>
<p>Browser then verifies:
1. Checks if hostname in cert is same as URL
2. Checks if CA is valid
3. Checks if cert is expired</p>
<ol>
<li>Browser and server creating a <strong>symmetric key</strong> (&quot;session key&quot;) that can be used for encrypting future data.</li>
<li>
<ul>
<li></li>
</ul>
</li>
<li>
<ul>
<li></li>
</ul>
</li>
<li>
<ul>
<li></li>
</ul>
</li>
<li>Browser and server created a <strong>symmetric key</strong> (&quot;session key&quot;) that can be used for encrypting future data.</li>
</ol>
<p>‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî</p>
<ol>
<li>TLS handshake
<ol>
<li>Exchange public key (asymmetric encryption)</li>
<li>Generate session keys (symmetric encryption)</li>
</ol>
</li>
<li>Exchange info using session keys</li>
</ol>
<p>‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî</p>
<p>https://decoder.link/sslchecker/</p>
<p>https://www.cloudflare.com/learning/ssl/how-does-ssl-work/</p>
<p>https://www.thesslstore.com/blog/how-does-https-work/</p>
<p>https://www.ssllabs.com/ssltest/analyze.html</p>
<p>https://hstspreload.org/</p>
<p>https://stackoverflow.com/a/67197597/4570466</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ssh"><a class="header" href="#ssh">SSH</a></h1>
<p>SSH implementations:</p>
<ul>
<li>OpenSSH (macOS)</li>
<li>PuTTY (Windows, Linux)</li>
</ul>
<p>https://robotmoon.com/ssh-tunnels/</p>
<p>2 asymmetric keys used ‚Äî key pair 1 (ephemeral; server: private key) &amp; key pair 2 (client: private key)</p>
<ol>
<li>
<p><strong>Client begins TCP handshake</strong> </p>
<p>(SSH is built on top of TCP)</p>
</li>
<li>
<p><strong>Set up session key (shared key)</strong></p>
<p>Ephemeral key pair 1 used to set up symmetrical encryption. Server gives the client the public key. Diffie-Hellman algorithm is used here.</p>
</li>
<li>
<p><strong>Client authenticates</strong></p>
<p>Use key pair 2 which has been generated previously. To authenticate, server uses public key 2 to encrypt some message. Client proves that it can decrypt using private key 2.</p>
<p>Client calculates a hash which is a function of the decrypted message and other metadata, then sends to server.</p>
<p>Server compares with its own calculation of hash (which should be the same).</p>
<p>Some authentication methods:</p>
<ul>
<li>RSA</li>
<li>ECDSA</li>
<li>Ed25519</li>
</ul>
</li>
<li>
<p><strong>Client accesses remote shell</strong></p>
<p>Not for Git, this part is not used. git clone command using SSH only involves establishing a secure connection between the client and server.</p>
</li>
</ol>
<p>Secure shell</p>
<p>Cryptographic protocol to allow a secure connection to a remote host over an unsecured network.</p>
<p>Authenticate using one of the following:</p>
<ul>
<li>Password</li>
<li>Private key</li>
<li>SSH certificates</li>
</ul>
<p><strong>SSH (Secure Shell)</strong></p>
<p>Cryptographic network protocol that provides administrators with a secure way to access a remote computer. SSH also refers to the suite of utilities that implement the protocol. Secure Shell provides strong authentication and secure encrypted data communications between two computers connecting over an insecure network such as the Internet. SSH is widely used by network administrators for managing systems and applications remotely, allowing them to log in to another computer over a network, execute commands and move files from one computer to another.</p>
<h1 id="workflow"><a class="header" href="#workflow">Workflow</a></h1>
<p><img src="layer-7/./ssh1.png" alt="SSH" /></p>
<h1 id="ssh-port-forwarding--ssh-tunnel"><a class="header" href="#ssh-port-forwarding--ssh-tunnel">SSH port forwarding / SSH tunnel</a></h1>
<ul>
<li>Local</li>
<li>Remote</li>
</ul>
<p><img src="layer-7/./ssh2.png" alt="SSH" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ssltls"><a class="header" href="#ssltls">SSL/TLS</a></h1>
<p>Secure Sockets Layer / Transport Layer Security</p>
<p>https://tls13.xargs.org/</p>
<p>Used for:</p>
<ol>
<li>Privacy: SSL encrypts data transmitted across the web</li>
<li>Authentication: make sure when you connect to google it‚Äôs actually Google</li>
<li>Data integrity: verifying data is not tampered with before reaching its intended recipient</li>
</ol>
<p>IN other words, HTTPS = HTTP + TLS.</p>
<p><strong>SSL certificate</strong></p>
<p>A SSL certificate contains:</p>
<ul>
<li>the hostname(s) it‚Äôs valid for</li>
<li>a public key</li>
<li>an expiration date</li>
<li>signature(s) from a CA</li>
</ul>
<p><strong>How SSL is issued</strong></p>
<p>CA (Certificate Authority), server, web browser</p>
<ol>
<li>CA signs the certificate with its own private key.</li>
<li>Server installs certificate.</li>
</ol>
<p>Free certificates are just as secure</p>
<p>WHo can sign? Certificate authority or you.</p>
<p><img src="layer-7/./ssl.png" alt="SSL" /></p>
<p>See a server's SSL cert</p>
<pre><code>openssl s_client -connect jvns.ca:443 -servername jvns.ca
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dns"><a class="header" href="#dns">DNS</a></h1>
<p>Domain Name System</p>
<p>DNS is a client-server application layer protocol that translates hostnames on the Internet to IP addresses. DNS is a server and a database.</p>
<p>Get my DNS server</p>
<pre><code>cat /etc/resolv.conf   
</code></pre>
<p>where nameserver is the local dns server</p>
<p>The computer has a Local resolver library to cache DNS mappings.</p>
<p>or</p>
<pre><code>nslookup &lt;anywebsite&gt;
</code></pre>
<p>Query DNS records</p>
<pre><code>nslookup                       
    -type=A/mx &lt;website&gt;
    -debug &lt;website&gt; 
host -t a/ns/mx &lt;website&gt;
dig @8.8.8.8 jvns.ca   @ means querying a 8.8.8.8 DNS server
dig +trace jvns.ca     Works like recursive DNS server
time dig @1.1.1.1 twitter.com
time dig @8.8.8.8 twitter.com
</code></pre>
<p>Reverse DNS lookup</p>
<pre><code>dig -x 172.17.13.217
</code></pre>
<p>Chrome DNS lookup</p>
<p>chrome://net-internals/#dns</p>
<blockquote>
<p>üí° &quot;DNS propagation&quot; is a misleading term. You're not actually waitinf for DNS records to propagate, you're waiting for cached records to expire.</p>
</blockquote>
<h1 id="dns-as-distributed-hierarchical-database"><a class="header" href="#dns-as-distributed-hierarchical-database"><strong>DNS as distributed hierarchical database</strong></a></h1>
<p>The DNS database is distributed</p>
<ul>
<li>To avoid single point of failure</li>
<li>To handle massive amounts of traffic</li>
<li>To make it closer to certain locations</li>
<li>To handle different domain hierarchies</li>
</ul>
<h1 id="anatomy-of-domain-name"><a class="header" href="#anatomy-of-domain-name"><strong>Anatomy of domain name</strong></a></h1>
<p>discuss.educative.io</p>
<pre><code>&lt;sub-domain&gt;.&lt;second level domain&gt;.&lt;top-level domain&gt;
</code></pre>
<h1 id="types-of-dns-servers"><a class="header" href="#types-of-dns-servers"><strong>Types of DNS servers</strong></a></h1>
<ul>
<li>Authoritative nameserver: source of truth</li>
<li>DNS recursor (eg. 8.8.8.8)</li>
</ul>
<h1 id="dns-1"><a class="header" href="#dns-1"><strong>DNS</strong></a></h1>
<p>Point of contact for DNS query</p>
<ol>
<li>Local DNS cache (local resolver library)</li>
<li>DNS recursor (eg. hosted by ISP or 1.1.1.1)</li>
<li>Root nameservers</li>
<li>TLD nameservers (.edu server) and sub-domain nameservers (cs.stanford.edu server)</li>
<li>Authoritative nameservers (stanford.edu server) (last stop)</li>
</ol>
<p><img src="layer-7/dns.png" alt="DNS" /></p>
<h1 id="dns-records--resource-records"><a class="header" href="#dns-records--resource-records"><strong>DNS records / resource records</strong></a></h1>
<p>A DNS record is a list of mappings of hostname to IP address. An entry has the format:</p>
<pre><code>(name, value, type, ttl)
</code></pre>
<p>where TTL (time-to-live) specifies how long the entry can be cached by the client. The values of ‚Äúname‚Äù, ‚Äúvalue‚Äù, and ‚Äútype‚Äù vary from record types.</p>
<h1 id="dns-resource-record-types"><a class="header" href="#dns-resource-record-types"><strong>DNS resource record types</strong></a></h1>
<h2 id="a-record-address-record"><a class="header" href="#a-record-address-record"><strong>A Record (Address Record)</strong></a></h2>
<p>Associates a domain name or subdomain with an IPv4 address (32-bit / 4 bytes / 4 octets).</p>
<pre><code>name            host    value         
------------------------------------
educative.io    @       104.20.7.183
</code></pre>
<h2 id="cname-record-canonical-name"><a class="header" href="#cname-record-canonical-name"><strong>CNAME Record (Canonical Name)</strong></a></h2>
<p>Associates a domain name with an alias of another canonical name.</p>
<pre><code>host    value (canonical name)       
------------------------------
www     educative.io
</code></pre>
<h2 id="mx-record"><a class="header" href="#mx-record"><strong>MX Record</strong></a></h2>
<p>An MX (Mail) record is used to direct email to a specific mail server. Like a CNAME record, MX entries must point to a host name and should not be pointed directly to an IP address.</p>
<pre><code>name=hostname
value=mailserver associated with host
type=MX
</code></pre>
<h2 id="ns-record-dns-name-server"><a class="header" href="#ns-record-dns-name-server"><strong>NS Record (DNS name server)</strong></a></h2>
<p>What DNS servers have the records for that domain?</p>
<pre><code>name=
value=
type=
ttl=
</code></pre>
<h2 id="aaaa-record-quad-a-record"><a class="header" href="#aaaa-record-quad-a-record"><strong>AAAA Record (‚Äúquad-A‚Äù record)</strong></a></h2>
<p>IPv6 (8 bytes)</p>
<pre><code>name=
value=
type=
ttl=
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="telnet"><a class="header" href="#telnet">Telnet</a></h1>
<p>Protocol to estable virtual terminal connection to remote host. Note that Telnet can be used to connect to any port on a remote host.</p>
<p>Telnet runs on top of TCP.</p>
<p>Type</p>
<pre><code>telnet example.com 80
</code></pre>
<p>and</p>
<pre><code>GET / HTTP/1.1
Host: www.example.com
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="websocket"><a class="header" href="#websocket">WebSocket</a></h1>
<p><a href="https://datatracker.ietf.org/doc/html/rfc6455">RFC 6455</a></p>
<p>A WebSocket connection is preferred when we need a persistent bi-directional (&quot;<strong>full duplex</strong>&quot;) low latency data flow from the client to the server and back. The connection is open for as long as we want. Eg. chat apps, real-time social streams, browser-based multiplayer games.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bgp"><a class="header" href="#bgp">BGP</a></h1>
<p>Border Gateway Protocol</p>
<p>When a router receives a packet, it uses a protocol called BGP to decide what router the packet should go to next.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dhcp"><a class="header" href="#dhcp">DHCP</a></h1>
<p>Dynamic Host Configuration Protocol</p>
<p>DHCP servers automatically assign an unused IPv4 address to a new host. When a host is first attached to a subnet, it sends a DHCP request message in a UDP segment to the DHCP server.</p>
<p>port: 67</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pop-imap"><a class="header" href="#pop-imap">POP, IMAP</a></h1>
<p>Post Office Protocol v3, Internet Message Access Protocol</p>
<p>POP/IMAP protocols are pull protocols used for getting email from an email server.</p>
<h1 id="pop"><a class="header" href="#pop"><strong>POP</strong></a></h1>
<p>POP phases</p>
<ol>
<li>User agent connects to POP server on TCP on port 110.</li>
<li>User agent authenticates.</li>
<li>User retrieves emails and mark emails for deletion.</li>
<li>Close the POP3 session. Server makes updates based on users command. Deletes email accordingly. Only inbox.</li>
</ol>
<p>Emails might not be in sync on multiple devices.</p>
<h1 id="imap"><a class="header" href="#imap"><strong>IMAP</strong></a></h1>
<p>(More complex)</p>
<ul>
<li>Emails are kept on the server and not deleted.</li>
<li>All folders are synced.</li>
<li>Inbox will be in sync on all devices.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="smtp"><a class="header" href="#smtp">SMTP</a></h1>
<p>Simple Mail Transfer Protocol (Sending Mail To People)</p>
<p>SMTP is a push protocol, used to send email out to the SMTP server whenever it needs to. SMTP uses TCP, which means that transfers are reliable. Connection is established at port 25.</p>
<ol>
<li>
<p>Email is sent to sender‚Äôs SMTP server.</p>
</li>
<li>
<p>Email is now placed on a message queue in the sending SMTP server.</p>
</li>
<li>
<p>Sender‚Äôs SMTP initiates a connection with the recipient‚Äôs SMTP server an will conduct an initial SMTP handshake.</p>
</li>
<li>
<p>Sender‚Äôs SMTP  the email to recipient‚Äôs SMTP server.</p>
<p>sends</p>
</li>
<li>
<p>Using a pull protocol, email is then downloaded from the recipient‚Äôs SMTP server.</p>
</li>
</ol>
<p><img src="layer-7/./smtp.png" alt="SMTP" /></p>
<h1 id="format"><a class="header" href="#format"><strong>Format</strong></a></h1>
<p>Note: All SMTP email messages are in 7-bit ASCII</p>
<pre><code>Delivered-To:¬†user@gmail.com
Date:¬†Thu,¬†16¬†May¬†2019¬†03:36:28¬†+0000¬†(UTC)
From:¬†Fahim¬†from¬†Educative¬†&lt;fahim+newsletter@educative.io&gt;
Mime-Version:¬†1.0
Reply-to:¬†fahim@educative.io
Subject:¬†Data¬†analysis¬†with¬†R
To:¬†user@gmail.com
¬†
Content-Transfer-Encoding:¬†quoted-printable
Content-Type:¬†text/plain;¬†charset=UTF-8
Mime-Version:¬†1.0
¬†
Hey¬†User,
¬†
Regards,
Raimi
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="layer-4---transport"><a class="header" href="#layer-4---transport">Layer 4 - Transport</a></h1>
<p>TCP: ‚ÄúYou, Packet 243, you first. You, Packet 132, you next.‚Äù</p>
<p>TCP:</p>
<pre><code class="language-kotlin">client ----syn------&gt; server
       &lt;----syn+ack--
       ----ack------&gt;
</code></pre>
<h1 id="transport-layer"><a class="header" href="#transport-layer">Transport layer</a></h1>
<p><strong>What are involved?</strong></p>
<p>End-system‚Äôs OS kernel, system libraries</p>
<p><strong>Responsibilities</strong></p>
<ul>
<li>Provides a layer of abstraction for application-to-application delivery</li>
<li>Segments the data</li>
<li>Allows multiple conversations to occur at once</li>
<li>Multiplexes and demultiplexes data</li>
<li>Correctness of data</li>
</ul>
<p>Connection-oriented protocol</p>
<h1 id="sockets"><a class="header" href="#sockets"><strong>Sockets</strong></a></h1>
<p>Sockets are gateways between applications and the network. Data is sent from application to socket. Sockets have an associated port number with them.</p>
<p>OS can take care of explicitly specifying a port. THis is called ephemeral ports, i.e.e OS will bind a socket to a port dynamically</p>
<h1 id="multiplexing-and-demultiplexing"><a class="header" href="#multiplexing-and-demultiplexing"><strong>Multiplexing and demultiplexing</strong></a></h1>
<p>Transport layer labels packets with the port number of the application a message is from and the one it is addressed to. This allows the layer to multiplex and demultiplex the data. TCP and UDP implement these differently.</p>
<h1 id="congestion"><a class="header" href="#congestion"><strong>Congestion</strong></a></h1>
<p>When more packets than the network has bandwidth for are sent through, some packets get dropped and some get delayed. Here are some fixes:</p>
<ul>
<li>Send packets at a slower rate in response to congestion</li>
<li>Track changes in traffic</li>
</ul>
<h1 id="principles-of-congestion-control"><a class="header" href="#principles-of-congestion-control"><strong>Principles of congestion control</strong></a></h1>
<ul>
<li>
<p>Bandwidth allocation</p>
<p>Bandwidth is allocated per connection. A host can open multiple connections. Bandwidth cannot be divided and allocated equally among end-systems because real traffic is transmitted in bursts and not in one continuous stream.</p>
</li>
<li>
<p>Fairness</p>
<p>Increasing the transmission rate. Of one end-system necessarily decreases another.</p>
</li>
<li>
<p>Convergence</p>
<p>Bandwidth should be allocated such that no one host hogs all of it.</p>
</li>
</ul>
<h1 id="principles-of-reliable-data-transfer"><a class="header" href="#principles-of-reliable-data-transfer"><strong>Principles of reliable data transfer</strong></a></h1>
<div class="table-wrapper"><table><thead><tr><th>Corrupted segments</th><th>Use checksum. Discard if invalid.</th></tr></thead><tbody>
<tr><td>Lost segments</td><td>Use retransmission timer*.</td></tr>
<tr><td>Duplicated or reordered segments</td><td>Use sequence numbers</td></tr>
</tbody></table>
</div>
<p>*TCP sends an acknowledgement for almost every segment</p>
<p><img src="layer-4/./layer-4-1.png" alt="Checksum" /></p>
<p><img src="layer-4/./layer-4-2.png" alt="TCP" /></p>
<p><strong>Pipelining using the sliding/sending window</strong></p>
<p>Method to wait for the acknowledgement of every transmitted message before sending another one. Go-back-n and selective repeat protocols ensure detection and retransmission of lost packets.</p>
<h1 id="terminologies"><a class="header" href="#terminologies"><strong>Terminologies</strong></a></h1>
<p>Rount trip time: time taken to send packet and get acknowledgement</p>
<p>Bandwidth: rate at which the newtwrok can transport bits</p>
<p>Throughput: amount of data that is actually transferred</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tcp"><a class="header" href="#tcp">TCP</a></h1>
<p>Transport Control Protocol</p>
<p>TCP is a connection-oriented protocol. It is full-duplex (both hosts on a TCP connection can send messages to each other simultaneously).</p>
<h1 id="analogy"><a class="header" href="#analogy"><strong>Analogy</strong></a></h1>
<ul>
<li>
<p>What if you <strong>can‚Äôt understand</strong></p>
<p>what your friend is saying?</p>
<ul>
<li>Should you ask them to <strong>repeat what they said</strong>?</li>
</ul>
</li>
<li>
<p>What if you haven‚Äôt <strong>heard them speak for a while</strong>?</p>
<ul>
<li>Does your friend simply <strong>not have anything to say?</strong></li>
<li>Has the phone lost reception and <strong>disconnected?</strong></li>
<li>Should you <strong>keep talking?</strong> If so, <strong>for how long</strong>?</li>
<li>Should both you and your friend periodically say ‚Äúmhmm‚Äù to indicate that you are present and listening?</li>
</ul>
</li>
</ul>
<h1 id="tcp-handshake-three-way"><a class="header" href="#tcp-handshake-three-way"><strong>TCP handshake (three-way)</strong></a></h1>
<ol>
<li>Client sends a TCP segment with SYN flag &amp; ‚Ä¶</li>
<li>Server replies a TCP segment with SYN and ACK flag &amp; ‚Ä¶</li>
<li>Client sends an ACK flag &amp; ‚Ä¶</li>
</ol>
<h1 id="how-it-works"><a class="header" href="#how-it-works"><strong>How it works</strong></a></h1>
<p>Ensures that messages are always (i) delivered (ii) in the correct order. TCP: ensures data reaches the intended destination and data is not corrupted.</p>
<ul>
<li>Accept data from a data stream</li>
<li>Divide into segments</li>
<li>Identify and retransmit messages accordingly</li>
<li>Reassemble messages if out of order</li>
</ul>
<h1 id="multiplexing-and-demultiplexing-1"><a class="header" href="#multiplexing-and-demultiplexing-1"><strong>Multiplexing and demultiplexing</strong></a></h1>
<p><img src="layer-4/./tcp3.png" alt="TCP" /></p>
<p><strong>TCP packet</strong></p>
<p>Consists of:</p>
<ul>
<li>Ethernet or wifi header</li>
<li>IP header</li>
<li>TCP header
<ul>
<li>Source port number</li>
<li>Destination port number</li>
<li>Sequence number</li>
<li>Acknowledgement number</li>
<li>Header length</li>
<li>‚Ä¶</li>
<li>Flag
<ul>
<li>synchronise</li>
<li>finish</li>
<li>push</li>
<li>reset</li>
<li>acknowledge</li>
<li>urgent</li>
</ul>
</li>
<li>Window size</li>
<li>Checksum</li>
<li>Urgent pointer</li>
<li>‚Ä¶</li>
</ul>
</li>
<li>Data (payload)</li>
</ul>
<p><img src="layer-4/./tcp2.png" alt="TCP" /></p>
<h1 id="control-measures"><a class="header" href="#control-measures"><strong>Control measures</strong></a></h1>
<ul>
<li>Congestion Control
<ul>
<li>TCP start sending data slowly and increase only when the other end can keep up.</li>
<li>TCP drops data when the other cannot keep up</li>
</ul>
</li>
<li>Flow control</li>
<li>Congestion control</li>
</ul>
<h1 id="applications-using-tcp"><a class="header" href="#applications-using-tcp"><strong>Applications using TCP</strong></a></h1>
<ul>
<li>Web browsing (HTTP, HTTPS)</li>
<li>FTP</li>
<li>SSH</li>
<li>Email (SMTP, IMAP, POP)</li>
<li>On-demand movie streaming</li>
</ul>
<h2 id="tcp-3-way-handshake"><a class="header" href="#tcp-3-way-handshake">TCP 3-way handshake</a></h2>
<p><img src="layer-4/./tcp3.png" alt="Untitled" /></p>
<p>Destination address is in IPv4</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="udp"><a class="header" href="#udp">UDP</a></h1>
<p>User Datagram Protocol</p>
<p>UDP is a connectionless protocol.</p>
<p><strong>How it works</strong></p>
<ul>
<li>UDP does not involve any initial handshaking.</li>
<li>Message may not get delivered.</li>
<li>Message may have some changes.</li>
<li>Message may be delivered in the wrong order.</li>
<li>Checks for corrupted message but does not correct them.</li>
</ul>
<p><strong>Multiplexing and demultiplexing</strong></p>
<p><strong>UDP message</strong></p>
<p>Consists of:</p>
<ul>
<li>Source port number</li>
<li>Destination port number</li>
<li>Length of datagram (max 2^16)</li>
<li>Checksum</li>
<li>Data</li>
</ul>
<p><strong>Applications using UDP</strong></p>
<ul>
<li>DNS</li>
<li>Xbox Live</li>
<li>Network management</li>
<li>Live audio/video streaming</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="layer-3---network-internet"><a class="header" href="#layer-3---network-internet">Layer 3 - Network (Internet)</a></h1>
<p>IP: ‚ÄúYou;re not supposed to be here!‚Äù</p>
<p><strong>What are involved?</strong></p>
<ul>
<li>
<p>Routers</p>
</li>
<li>
<p>End-systems</p>
</li>
<li>
<p>Middleboxes (software)</p>
<p><strong>Firewall</strong></p>
<p>Possible filters</p>
<ul>
<li>Source address (blacklist)</li>
<li>Destination address</li>
<li>Protocol number</li>
<li>TCP or UDP port number</li>
<li>TCP flags</li>
</ul>
<p>Types</p>
<ul>
<li>Stateless</li>
<li>Stateful (session-based i.e. all subsequent packets are allowed through)</li>
</ul>
<p><strong>NATs</strong></p>
<p>Network Address Translation</p>
<p><strong>A NAT allows all of the hosts of a router share one or a few public IPv4 addresses (usually between private and public).</strong> This is to deal with shortage of IPv4 addresses. What it does is to modify the IP addresses in the IP header.</p>
</li>
</ul>
<p><strong>Responsibility</strong></p>
<ul>
<li>Host addressing</li>
<li>Message forwarding: Since many networks are partitioned into subnetworks and connect to other networks for wide-area communications, networks use specialised hosts, called gateways or¬†routers, to forward packets between networks.</li>
</ul>
<p><strong>Protocols</strong></p>
<p><strong>packets</strong></p>
<p>The unit of information in the network layer</p>
<p><strong>Routing</strong></p>
<p>The process of selecting a path for traffic in a network / between networks / across multiple networks</p>
<p><strong>Datagram</strong></p>
<p>A basic transfer unit</p>
<p><strong>IP address</strong></p>
<p>To identify each device in the world-wide web, Internet Assigned Numbers Authority (IANA) assigns IPV4 address as a unique identifier for each device on the Internet. Length of the IP address is 32 bits. Hence there are</p>
<p><strong>2</strong></p>
<p>32</p>
<p>2</p>
<p>32</p>
<p>IP addresses. Local IP is given by local router.</p>
<p><strong>Router</strong></p>
<p>A network device that can (i) bridge between different networks together, (ii) assign IP addresses using a protocol called DHCP, and (iii) determine what traffic can pass between them (most routers have a built-in Firewall).</p>
<h1 id="devices"><a class="header" href="#devices"><strong>Devices</strong></a></h1>
<ul>
<li>End host</li>
<li>Router</li>
<li>Middleboxes: eg. firewalls, network address translation devices</li>
</ul>
<h1 id="organisation-of-the-network-layer"><a class="header" href="#organisation-of-the-network-layer"><strong>Organisation of the network layer</strong></a></h1>
<ul>
<li>Datagram organisation: use forwarding table</li>
<li>Virtual circuit organisation</li>
<li>Two conceptual planes:
<ul>
<li>Data plane: protocols for hosts and routers to exchange packets carrying user data</li>
<li>Control plane: protocols for routers to efficiently forward packets to final destination</li>
</ul>
</li>
</ul>
<p>Routing protocols</p>
<ul>
<li>Static: manually compute routes</li>
<li>Dynamic</li>
</ul>
<h1 id="routing-table"><a class="header" href="#routing-table"><strong>Routing table</strong></a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ip"><a class="header" href="#ip">IP</a></h1>
<p>Internet Protocol</p>
<p>To be able to use the underlying data link technologies</p>
<h1 id="assumptions"><a class="header" href="#assumptions"><strong>Assumptions</strong></a></h1>
<ul>
<li>To provide unreliable connectionless services</li>
<li>IP hosts must have fixed size 32-bit addresses</li>
<li>IP must be compatible with a variety of data link layers</li>
<li>IP hosts should be able to exchange variable-length packets</li>
</ul>
<h1 id="ip-addresses"><a class="header" href="#ip-addresses"><strong>IP addresses</strong></a></h1>
<p>32-bit numbers written as 4 bytes. Eg. 1.2.3.4 corresponds to 00000001000000100000001100000100.</p>
<h1 id="multihoming"><a class="header" href="#multihoming"><strong>Multihoming</strong></a></h1>
<p>A router has as many IPv4 addresses as the number of interfaces it has in the data link later. These hosts are said to be multihomed.</p>
<p><img src="layer-3/./ip1.png" alt="IP" /></p>
<h1 id="address-classes"><a class="header" href="#address-classes"><strong>Address classes</strong></a></h1>
<div class="table-wrapper"><table><thead><tr><th>Class</th><th>Length of subnet ID</th><th>Range</th><th>Default subnet mask</th><th>Remarks</th></tr></thead><tbody>
<tr><td>Class A</td><td>1 octet</td><td>0.0.0.0 to 127.255.255.255</td><td>255.0.0.0</td><td></td></tr>
<tr><td>Class B</td><td>2 octets</td><td>128.0.0.0 to 191.255.255.255</td><td>255.255.0.0</td><td></td></tr>
<tr><td>Class C</td><td>3 Octets</td><td>192.0.0.0 to 223.255.255.255</td><td>255.255.255.0</td><td></td></tr>
<tr><td>Class D</td><td></td><td></td><td></td><td>For multicast</td></tr>
<tr><td>Class E</td><td></td><td></td><td></td><td>Reserved</td></tr>
</tbody></table>
</div>
<h1 id="subnetting"><a class="header" href="#subnetting"><strong>Subnetting</strong></a></h1>
<ul>
<li>Subnetting based on octets (deprecated).</li>
<li>Variable-length subnetting.</li>
</ul>
<div class="table-wrapper"><table><thead><tr><th>Subnet</th><th>No. of possible addresses</th><th>Lowest address</th><th>Highest address</th></tr></thead><tbody>
<tr><td>10.0.0.0/30</td><td>2^2</td><td>10.0.0.0</td><td>10.0.0.3</td></tr>
<tr><td>192.0.2.0/24</td><td>2^8</td><td>192.0.2.0</td><td>192.0.2.255</td></tr>
</tbody></table>
</div>
<h1 id="address-assignment-using-subnetting"><a class="header" href="#address-assignment-using-subnetting"><strong>Address assignment using subnetting</strong></a></h1>
<ul>
<li>Subnet mask: host bits set to 0
eg. 203.128.22.0 and a host can be 203.128.22.7</li>
<li>Network address: host bits set to 0
eg. 203.128.22.0.</li>
<li>Broadcast address: host bits set to 255 (all binary 1‚Äôs)
eg. 203.128.22.255</li>
<li>Host address: host bits
eg. 203.128.22.18</li>
</ul>
<h1 id="special-addresses"><a class="header" href="#special-addresses"><strong>Special addresses</strong></a></h1>
<p><strong>Self-identification</strong></p>
<p>0.0.0.0/8</p>
<p><strong>Loopback address</strong></p>
<p>127.0.0.1/8</p>
<p>Each IPv4 host has a loopback interface that is not attached to a data link layer. This allows processes running on a host to use TCP/IP to contact other processes running on the same host. This is very useful for testing purposes.</p>
<p><strong>Private addresses</strong></p>
<p>10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16</p>
<p>Private networks that are not directly attached to the Internet.</p>
<p><strong>Link-local address</strong></p>
<p>169.254.0.0/16</p>
<h1 id="routing"><a class="header" href="#routing"><strong>Routing</strong></a></h1>
<p>Routing is done via a routing table and longest prefix match.</p>
<h1 id="interfaces"><a class="header" href="#interfaces"><strong>Interfaces</strong></a></h1>
<p>Hosts (computers) don‚Äôt have IP addresses. Interfaces on hosts have IP addresses.</p>
<p>Interfaces</p>
<ul>
<li>Ethernet interface</li>
<li>Wifi interface</li>
<li>Loopback interface</li>
<li>Tunnel interface</li>
<li>Virtual machine interface</li>
</ul>
<h1 id="ipv4-packet-header"><a class="header" href="#ipv4-packet-header"><strong>IPv4 packet header</strong></a></h1>
<ul>
<li>Version</li>
<li>Length</li>
<li>Source address</li>
<li>Destination address</li>
<li>Protocol
<ul>
<li>Protocol ‚Äú1‚Äù is ICMP.</li>
</ul>
</li>
<li>Checksum</li>
<li>Flags</li>
<li>TTL</li>
<li>IP data (payload)</li>
</ul>
<h1 id="fragmentation-and-reassembly"><a class="header" href="#fragmentation-and-reassembly"><strong>Fragmentation and reassembly</strong></a></h1>
<p>IPv4 packets need to be fragmented depending on the data link layer‚Äôs maximum transmission capability. They can be as big as 64KB.</p>
<p><img src="layer-3/./ip2.png" alt="IP" /></p>
<h1 id="nat-network-address-translation"><a class="header" href="#nat-network-address-translation"><strong>NAT (Network Address Translation)</strong></a></h1>
<p><img src="layer-3/./ip3.png" alt="IP" /></p>
<p>Router is a device that connects two different IP networks.</p>
<p><img src="layer-3/./ip4.png" alt="IP" /></p>
<p><img src="layer-3/./ip5.png" alt="IP" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="icmp"><a class="header" href="#icmp">ICMP</a></h1>
<p>Internet Control Message Protocol</p>
<p>For diagnostics</p>
<ul>
<li>Used by
<ul>
<li>ping</li>
<li>traceroute</li>
</ul>
</li>
</ul>
<p><strong>Messages</strong></p>
<ul>
<li>Destination unreachable
<ul>
<li>Network unreachable</li>
<li>Host unreachable</li>
<li>Protocol unreachable</li>
<li>Port unreachable</li>
</ul>
</li>
<li>Fragmentation needed</li>
<li>Redirect</li>
<li>Time exceeded</li>
<li>Echo request and echo reply</li>
<li>‚Ä¶</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ipsec"><a class="header" href="#ipsec">IPSec</a></h1>
<p>Secure network protocol suite that authenticates and encrypts packets of data.</p>
<p>Used in VPNs.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="layer-12---physicaldatalink"><a class="header" href="#layer-12---physicaldatalink">Layer 1/2 - Physical/Datalink</a></h1>
<ul>
<li>Guided
<ul>
<li>Twisted pair copper wire (carry electrical signals)</li>
<li>Coaxial cable (carry electrical signals)</li>
<li>Fiber optics (carry light)
<ul>
<li>Multimode. Uses LED; works over 10km.</li>
<li>Monomode. Uses laser; works over a few km.</li>
</ul>
</li>
</ul>
</li>
<li>Unguided
<ul>
<li>Terrestrial radio channels (radio waves):
<ul>
<li>1-2 meters: Bluetooth</li>
<li>Up to 100 meters: WiFi</li>
<li>Up to kilomteres: 3G, 4G, LTE</li>
</ul>
</li>
<li>Free-space optical communication (light)</li>
</ul>
</li>
</ul>
<p>Metallic media suffer from electrical noise and interference from nearby electrical sources.</p>
<hr />
<p>Transmission and reception of raw bit streams over a physical medium. Conversion of signals.</p>
<p>Physical devices: Network interface card</p>
<p><strong>What are involved?</strong></p>
<p><strong>?</strong></p>
<p><strong>Responsibilities</strong></p>
<p>Receive packet from network layer and deals with providing hop-to-hop communication between entities directly connected by a physical link.</p>
<ul>
<li>MAC layer
Responsible for controlling how devices in a network gain access to a medium and permission to transmit data</li>
<li>Logical link control layer</li>
</ul>
<p><strong>Protocols</strong></p>
<ul>
<li>802.3¬†Ethernet</li>
<li>802.11¬†Wi-Fi</li>
<li>Token Ring</li>
<li>FDDI</li>
</ul>
<p>Deals with framing (of the signal bits)</p>
<p><strong>Medium Access Control</strong></p>
<p>Controls the interaction between hardware and wired/optical/wireless medium. Data link layer addresses used in Ethernet networks are often called MAC addresses</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="arp"><a class="header" href="#arp">ARP</a></h1>
<p>Address Resolution Protocol</p>
<p>Data link layer protocol that maps end host‚Äôs IP address to data link‚Äôs address</p>
<p>To find the address,</p>
<ol>
<li>Check the IPv4 host‚Äôs ARP cache</li>
<li>If none, send a broadcast ARP query frame on the LAN. This frame is received by all devices on the LAN. Host who knows the answer will reply</li>
<li>Sender updates ARP cache</li>
</ol>
<p>Address Resolution Protocol</p>
<p>mapping of (MAC address) ‚Üí (IP address). This table is an <strong>ARP cache</strong>.</p>
<p>Hosts have this table. If the host doesn‚Äôt know a MAC address for a certain IP address, it sends out an <strong>ARP request packet</strong>, asking other machines for the matching MAC address.</p>
<p>The Address Resolution Protocol (ARP) is used to map an IP address to a fixed MAC address. If a host does not know a MAC address for a certain IP address, it broadcasts an ARP request packet asking other machines who is this. The machine with the corresponding IP address responds to this with an ARP reply packet with the MAC address. This result is stored in the ARP cache of the host.</p>
<div class="table-wrapper"><table><thead><tr><th>MAC address</th><th>IP address</th></tr></thead><tbody>
<tr><td>5f:44:11</td><td>192.20.1.1</td></tr>
<tr><td></td><td></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="standards"><a class="header" href="#standards">Standards</a></h1>
<ul>
<li>MIME type</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="access-networks"><a class="header" href="#access-networks">Access networks</a></h1>
<p>Networks that physically connect end systems (laptop, mobile phones) to the first router.</p>
<ul>
<li>Physical
<ul>
<li>DSL modem (Digital Subscriber Line)
<ul>
<li>Using telephony infrastructure thru telephone wires</li>
</ul>
</li>
<li>Dial-up
<ul>
<li>Using telephony infrastructure thru telephone wires</li>
</ul>
</li>
<li>Cable internet
<ul>
<li>Using cable TV infrastructure thru coaxial cable</li>
</ul>
</li>
<li>FTTH (Fiber to the home)
<ul>
<li>Using optic fibres</li>
</ul>
</li>
</ul>
</li>
<li>Remote
<ul>
<li>Satellite</li>
<li>WiFi</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="socket"><a class="header" href="#socket">Socket</a></h1>
<h3 id="socket-1"><a class="header" href="#socket-1"><strong>Socket</strong></a></h3>
<p>A socket is the software interface between a process (the ‚Äúport‚Äù that an application reserved) and the computer network (which is defined by the machine‚Äôs ‚ÄúIP address‚Äù in the network).</p>
<p>So, technically, processes communicate with each other using sockets.</p>
<p>Unix domain socket</p>
<ul>
<li>Data sent to unix socket never gets lost</li>
<li>Use them to communicate between processes on the same computer</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="type-a-url-on-the-browser"><a class="header" href="#type-a-url-on-the-browser">Type a URL on the browser</a></h1>
<p>https://twitter.com/manekinekko/status/1281704000572858375</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h1>
<h1 id="quicks"><a class="header" href="#quicks">Quicks</a></h1>
<p><code>netstat</code> see open ports</p>
<h1 id="transport-layer-1"><a class="header" href="#transport-layer-1">Transport layer</a></h1>
<pre><code>sudo lsof     list files and processes
    -i        list only network sockets
    -i:8080   at port 8080
    -t        show only process ID
    -P        show port
</code></pre>
<p>View UDP packets</p>
<pre><code>tcpdump [udp]
    -c 10            capture 10 packets
    -w output.pcap   write to a file
    -r output.pcap   read a file
    -X               print hex and ASCII
</code></pre>
<p><img src="./troubleshooting1.png" alt="" /></p>
<p><img src="./troubleshooting2.png" alt="" /></p>
<p><img src="./troubleshooting3.png" alt="" /></p>
<p>Capture packets on en0 interface</p>
<pre><code>sudo tcpdump -i [en0|lo0]
</code></pre>
<p>Capture packets that are to or from my computer</p>
<pre><code>sudo tcpdump -p

sudo tcpdump [...] [and|or] [...]
    [src|dest|tcp] port &lt;port-no&gt;
    host &lt;IP-addr&gt;
</code></pre>
<p>Make TCP connections: chat server</p>
<pre><code>{
    nc -l 3456
}
{
    nc localhost 3456
}
</code></pre>
<p>Make tcp connections: file server</p>
<pre><code>{
    nc -l 4444 &gt; myfile.txt
}
{
    echo &quot;hiiii&quot; &gt; thefile.txt
    nc localhost 4444 &lt; thefile.txt
}
</code></pre>
<p>Netcat</p>
<pre><code>nc 
    en.wikipedia.org 80 other args 
    localhost 3456         client
    -l 3456                listen on port 3456
    -l 3456 | /bin/bash    listen on port 3456
    -z localhost 3456-3457 port scanning from 3456 to 3457
    -lU /var/tmp/dsocket   create a listening stream socket
    -U /var/tmp/dsocket    connect to an existing stream socket
    -v verbose
</code></pre>
<h1 id="network-layer"><a class="header" href="#network-layer">Network layer</a></h1>
<p>IP</p>
<pre><code>curl ifconfig.me
</code></pre>
<p>My IP address</p>
<pre><code>ipconfig getifaddr en0
</code></pre>
<p>Find default gateway</p>
<pre><code>ip route show default
netstat -nr
route -n get default
</code></pre>
<p>ICMP: echo request &amp; reply</p>
<pre><code>ping 8.8.8.8 send and receive network traffic with this address (‚Äòping server‚Äô)
    -c3 send 3 packets then stop
</code></pre>
<p><img src="./troubleshooting4.png" alt="" /></p>
<p>(TTL=no.of hops before being discarded)</p>
<p>Sending ICMP messages</p>
<pre><code>traceroute [address]   list hops between host and other host
	-m max TTL
</code></pre>
<p>List devices connected</p>
<pre><code>arp -na list all devices connected to subnet
</code></pre>
<pre><code>nmap -sP 192.168.1.0/24
</code></pre>
<pre><code>netstat -pant | grep LISTEN
</code></pre>
<pre><code>curl https://ipvigilante.com/133.237.7.85 | jq
</code></pre>
<pre><code>nc google.com 80
</code></pre>
<p>See what steps your packet takes to get somewhere</p>
<pre><code>traceroute google.com
</code></pre>
<h1 id="data-link-layer"><a class="header" href="#data-link-layer">Data link layer</a></h1>
<p>List of interfaces</p>
<pre><code>ifconfig / ip
ifconfig en0
</code></pre>
<p>&quot;Block&quot; websites</p>
<pre><code>127.0.0.1 www.facebook.com
127.0.0.1 facebook.com
127.0.0.1 login.facebook.com
127.0.0.1 www.login.facebook.com
127.0.0.1 fbcdn.net
127.0.0.1 www.fbcdn.net
127.0.0.1 fbcdn.com
127.0.0.1 www.fbcdn.com
127.0.0.1 static.ak.fbcdn.net
127.0.0.1 static.ak.connect.facebook.com
127.0.0.1 connect.facebook.net
127.0.0.1 www.connect.facebook.net
127.0.0.1 apps.facebook.com
::1 www.facebook.com
::1 facebook.com
::1 login.facebook.com
::1 www.login.facebook.com
::1 fbcdn.net
::1 www.fbcdn.net
::1 fbcdn.com
::1 www.fbcdn.com
::1 static.ak.fbcdn.net
::1 static.ak.connect.facebook.com
::1 connect.facebook.net
::1 www.connect.facebook.net
::1 apps.facebook.com
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="mermaid.min.js"></script>
        <script type="text/javascript" src="mermaid-init.js"></script>

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
