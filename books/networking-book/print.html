<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>networking-book</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./mdbook-admonish.css">
        <link rel="stylesheet" href="../css/theme/catppuccin.css">
        <link rel="stylesheet" href="../css/theme/catppuccin-highlight.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="preface.html">Preface</a></li><li class="chapter-item expanded affix "><a href="osi-model.html">OSI model</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Topology</li><li class="chapter-item expanded "><a href="cloud-topology.html">Cloud</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Network architectures</li><li class="chapter-item expanded "><div>Client-server</div></li><li class="chapter-item expanded "><div>P2P</div></li><li class="chapter-item expanded "><div>Hybrid</div></li><li class="chapter-item expanded "><div>Data centres</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Software/hardware layers</li><li class="chapter-item expanded "><div>Application</div></li><li class="chapter-item expanded "><a href="software-hardware-layers/socket.html">Socket</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="software-hardware-layers/socket/sock-stream.html">SOCK_STREAM</a></li><li class="chapter-item expanded "><a href="software-hardware-layers/socket/sock-dgram.html">SOCK_DGRAM</a></li><li class="chapter-item expanded "><a href="software-hardware-layers/socket/sock-raw.html">SOCK_RAW</a></li></ol></li><li class="chapter-item expanded "><a href="software-hardware-layers/route-table.html">Route table</a></li><li class="chapter-item expanded "><a href="software-hardware-layers/interfaces.html">Network interface</a></li><li class="chapter-item expanded "><a href="software-hardware-layers/network-interface-card.html">Network Interface Controller</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Tunnel protocols</li><li class="chapter-item expanded "><div>VPN goals</div></li><li class="chapter-item expanded "><a href="vpn/index.html">VPN</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="vpn/ipsec.html">IPSec</a></li><li><ol class="section"><li class="chapter-item expanded "><div>IKE</div></li><li class="chapter-item expanded "><a href="vpn/ikev2.html">IKEv2</a></li></ol></li><li class="chapter-item expanded "><div>SSL VPN</div></li><li class="chapter-item expanded "><a href="vpn/openvpn.html">OpenVPN</a></li><li class="chapter-item expanded "><a href="vpn/wireguard.html">WireGuard</a></li></ol></li><li class="chapter-item expanded "><div>Cloudflare tunnel</div></li><li class="chapter-item expanded "><a href="vpn/split-tunnelling.html">Split tunnelling</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Firewalls</li><li class="chapter-item expanded "><div>Application-level</div></li><li><ol class="section"><li class="chapter-item expanded "><div>Stateless</div></li><li class="chapter-item expanded "><div>Stateful</div></li></ol></li><li class="chapter-item expanded "><div>Packet-level</div></li><li><ol class="section"><li class="chapter-item expanded "><div>Stateless</div></li><li class="chapter-item expanded "><div>Stateful</div></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Protocols: OSI Layer 7 — Application</li><li class="chapter-item expanded "><a href="osi-layer-7/index.html">Overview</a></li><li class="chapter-item expanded "><a href="osi-layer-7/http.html">HTTP</a></li><li><ol class="section"><li class="chapter-item expanded "><div>Workflow</div></li><li class="chapter-item expanded "><a href="osi-layer-7/http/message-format.html">Message format</a></li><li class="chapter-item expanded "><a href="osi-layer-7/http/features.html">Features</a></li><li class="chapter-item expanded "><a href="osi-layer-7/http/tunnel.html">HTTP tunnel</a></li><li class="chapter-item expanded "><a href="osi-layer-7/http/browser.html">Browser</a></li><li class="chapter-item expanded "><a href="osi-layer-7/https.html">HTTPS</a></li></ol></li><li class="chapter-item expanded "><a href="osi-layer-7/ssh.html">SSH</a></li><li class="chapter-item expanded "><a href="osi-layer-7/dns/index.html">DNS</a></li><li><ol class="section"><li class="chapter-item expanded "><div>Setup: DNS registrars</div></li><li class="chapter-item expanded "><div>Setup: DNS servers</div></li><li class="chapter-item expanded "><div>Setup: Client-server</div></li><li class="chapter-item expanded "><div>Workflow</div></li><li class="chapter-item expanded "><a href="osi-layer-7/dns/record-types.html">Record types</a></li><li class="chapter-item expanded "><a href="osi-layer-7/dns/doh.html">DoH</a></li><li class="chapter-item expanded "><div>DoT</div></li></ol></li><li class="chapter-item expanded "><a href="osi-layer-7/sftp.html">SFTP</a></li><li class="chapter-item expanded "><div>MQTT</div></li><li class="chapter-item expanded "><div>NTP</div></li><li class="chapter-item expanded "><div>SCP</div></li><li class="chapter-item expanded "><a href="osi-layer-7/websocket.html">WebSocket</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="osi-layer-7/websocket-secure.html">WebSocket Secure</a></li></ol></li><li class="chapter-item expanded "><a href="osi-layer-7/telnet.html">Telnet</a></li><li class="chapter-item expanded "><a href="osi-layer-7/bgp.html">BGP</a></li><li class="chapter-item expanded "><a href="osi-layer-7/dhcp.html">DHCP</a></li><li class="chapter-item expanded "><a href="osi-layer-7/pop-imap.html">POP, IMAP</a></li><li class="chapter-item expanded "><a href="osi-layer-7/smtp.html">SMTP</a></li><li class="chapter-item expanded "><a href="osi-layer-7/tor.html">Tor</a></li><li class="chapter-item expanded "><a href="osi-layer-7/icloud-private-relay.html">iCloud Private Relay</a></li><li class="chapter-item expanded "><div>LDAP</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Protocols: OSI Layer 6 — Presentation</li><li class="chapter-item expanded "><a href="osi-layer-6/tls/index.html">TLS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="osi-layer-6/tls/trust-chain.html">Setup: Trust chain</a></li><li class="chapter-item expanded "><a href="osi-layer-6/tls/setup.html">Setup: Client-server</a></li><li class="chapter-item expanded "><div>Workflow</div></li><li class="chapter-item expanded "><div>DTLS</div></li><li class="chapter-item expanded "><a href="osi-layer-6/tls/cipher-suite.html">TLS cipher suite</a></li><li class="chapter-item expanded "><a href="osi-layer-6/tls/ssl-proxying.html">SSL proxying</a></li><li class="chapter-item expanded "><a href="osi-layer-6/tls/ssl-pinning.html">SSL pinning</a></li></ol></li><li class="chapter-item expanded "><a href="osi-layer-6/ssh/index.html">SSH</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="osi-layer-6/ssh/setup.html">Setup: Client-server</a></li><li class="chapter-item expanded "><a href="osi-layer-6/ssh/workflow.html">Workflow</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Protocols: OSI Layer 5 — Session</li><li class="chapter-item expanded "><div>SOCKS</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Protocols: OSI Layer 4 — Transport</li><li class="chapter-item expanded "><a href="osi-layer-4/transport-layer.html">Overview</a></li><li class="chapter-item expanded "><a href="osi-layer-4/tcp.html">TCP</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="osi-layer-4/tcp/3-way-handshake.html">Workflow</a></li><li class="chapter-item expanded "><a href="osi-layer-4/tcp/message-format.html">Message format</a></li><li class="chapter-item expanded "><a href="osi-layer-4/tcp/inspect.html">Tools</a></li></ol></li><li class="chapter-item expanded "><a href="osi-layer-4/udp.html">UDP</a></li><li class="chapter-item expanded "><a href="osi-layer-4/quic.html">QUIC</a></li><li class="chapter-item expanded "><a href="osi-layer-4/ssh/ssh-tunnel.html">SSH tunnel</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Protocols: OSI Layer 3 — Network</li><li class="chapter-item expanded "><a href="osi-layer-3/network-layer.html">Overview</a></li><li class="chapter-item expanded "><a href="osi-layer-3/ipv4.html">IP</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="osi-layer-3/ip/routing.html">Workflow: Message routing</a></li><li class="chapter-item expanded "><a href="osi-layer-3/ip/ip-packet.html">Message format</a></li><li class="chapter-item expanded "><a href="osi-layer-3/ip/ip-addresses.html">Host addressing</a></li><li class="chapter-item expanded "><a href="osi-layer-3/ip/fragmentation-and-reassembly.html">Fragmentation and reassembly</a></li></ol></li><li class="chapter-item expanded "><a href="osi-layer-3/icmp.html">ICMP</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Protocols: OSI Layer 1 — Datalink</li><li class="chapter-item expanded "><a href="osi-layer-1/index.html">Overview</a></li><li class="chapter-item expanded "><a href="osi-layer-1/arp.html">ARP</a></li><li class="chapter-item expanded "><div>802.11 Wi-Fi</div></li><li class="chapter-item expanded "><div>802.3 Ethernet</div></li><li class="chapter-item expanded "><div>NFC</div></li><li class="chapter-item expanded "><div>Bluetooth</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">?</li><li class="chapter-item expanded "><a href="access-networks.html">Access networks</a></li><li class="chapter-item expanded "><a href="osi-layer-3/router.html">Router</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Unclassified</li><li class="chapter-item expanded "><a href="standards.html">Standards</a></li><li class="chapter-item expanded "><a href="what-happens.html">Type a URL on the browser</a></li><li class="chapter-item expanded "><a href="troubleshooting.html">Troubleshooting</a></li><li class="chapter-item expanded "><div>Compression</div></li><li class="chapter-item expanded "><div>MIME</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">networking-book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="preface"><a class="header" href="#preface">Preface</a></h1>
<ul>
<li>http://flashcards.wizardzines.com</li>
<li>https://jvns.ca/networking-zine.pdf</li>
</ul>
<p>(jvns’s network zines)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osi-model"><a class="header" href="#osi-model">OSI model</a></h1>
<p>Open Systems Interconnection model</p>
<p>OSI model vs. TCP/IP model</p>
<p><img src="./tcp-ip.png" alt="TCP/IP model" />
<img src="./tcp-ip-2.png" alt="TCP/IP model" />
<img src="./tcp-ip-3.png" alt="TCP/IP model" /></p>
<div class="table-wrapper"><table><thead><tr><th>TCP/IP layer</th><th>OSI layers</th><th>Data</th><th>Concepts</th><th>Protocols</th><th>Where</th></tr></thead><tbody>
<tr><td>Layer 4  Application</td><td>5,6,7</td><td>User data like email, webpage</td><td></td><td>HTTP, SSH, WebSocket, DNS, TLS, Telnet, DHCP, IMAP, POP, SMTP, BGP</td><td></td></tr>
<tr><td>Layer 3  Transport</td><td>4</td><td>Source &amp; dest port, ACK Checksum—(above)</td><td>Ensure successful and reliable delivery. Requires syncing up with recipient. Segments the data. Ports. Sessions. Stream sockets.</td><td>TCP, UDP</td><td>OS kernel, system libraries</td></tr>
<tr><td>Layer 2  Internet</td><td>3</td><td>Source &amp; dest IP addr—(above)</td><td>Routing, addressing, subnetting, packets</td><td>IP, ICMP</td><td>OS kernel, routers</td></tr>
<tr><td>Layer 1  Network access/link</td><td>1,2</td><td></td><td>Handles physical infrastructure and conversion digital data to signals.</td><td>Ethernet, Wi-Fi, MAC</td><td>Device drivers</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="cloud"><a class="header" href="#cloud">Cloud</a></h1>
<p><img src="./cloud-topology.png" alt="Cloud topology" /></p>
<h2 id="route-53"><a class="header" href="#route-53">Route 53</a></h2>
<p>Mapping of domain name to AWS resource.</p>
<h2 id="vpc"><a class="header" href="#vpc">VPC</a></h2>
<p>...</p>
<h2 id="subnet"><a class="header" href="#subnet">Subnet</a></h2>
<p>A subnet is associated with a VPC.</p>
<h2 id="internet-gateway"><a class="header" href="#internet-gateway">Internet gateway</a></h2>
<p>An Internet gateway is associated with a VPC.</p>
<h2 id="nat-gateway"><a class="header" href="#nat-gateway">NAT gateway</a></h2>
<p>A NAT gateway must be associated with a public subnet. </p>
<p>It is used to enable instances in a <em>private subnet</em> to initiate IPv4 outbound traffic to internet or other services. </p>
<p>it only handles the inbound responses from those outbound requests. </p>
<h2 id="route-table"><a class="header" href="#route-table">Route table</a></h2>
<p>A <strong>main route table</strong> is created for a VPC by default. </p>
<p>Any subnets created within this VPC can either be associated with either</p>
<ul>
<li>the main route table (default), or</li>
<li>a <strong>custom route table</strong></li>
</ul>
<h2 id="vpc-peering"><a class="header" href="#vpc-peering">VPC peering</a></h2>
<p>A network connection between two VPCs.</p>
<p>New routes should be added to the VPC's route table to specify which traffic should traverse the peering connection.</p>
<h2 id="network-acl"><a class="header" href="#network-acl">Network ACL</a></h2>
<p>A Network ACL is associated with a subnet.</p>
<h2 id="security-group"><a class="header" href="#security-group">Security group</a></h2>
<p>A security group is associated with a resource / EC2 instance.</p>
<h2 id="eni"><a class="header" href="#eni">ENI</a></h2>
<p>An Elastic Network Interface is associated with an instance. More than one ENIs can be attached to an instance. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="socket"><a class="header" href="#socket">Socket</a></h1>
<p>A socket is a software object <em>provided by the OS</em> to allow applications to send and receive data across the network.</p>
<pre><code>man 2 socket
</code></pre>
<div id="admonition-osi-model" class="admonition info">
<div class="admonition-title">
<p>OSI model</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/socket.html#admonition-osi-model"></a></p>
</div>
<div>
<p>Sockets is OSI Layer 4 and 5.</p>
</div>
</div>
<p>Sockets are an abstraction of the network interface, encompassing Layer 3 (<code>SOCK_RAW</code>) and Layer 4 (<code>SOCK_STREAM</code> and <code>SOCK_DGRAM</code>; TCP and UDP respectively). The system call allows you to:</p>
<ul>
<li>Create socket</li>
<li>Bind socket to an IP address</li>
<li>Connect socket to an IP address</li>
<li>Write data to socket — using the routing table</li>
<li>Read data from socket — using the destination IP address and port number from the data</li>
</ul>
<div id="admonition-socket-vs-unix-domain-socket" class="admonition note">
<div class="admonition-title">
<p>Socket vs. Unix domain socket</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/socket.html#admonition-socket-vs-unix-domain-socket"></a></p>
</div>
<div>
<p>A socket is not the same as the Unix domain socket.</p>
</div>
</div>
<div id="admonition-socket-vs-port" class="admonition note">
<div class="admonition-title">
<p>Socket vs. port</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/socket.html#admonition-socket-vs-port"></a></p>
</div>
<div>
<p>A socket is not a port.</p>
<p>A port is another software construct defined by the OS to differentiate between different programs or processes running on the same machine.</p>
</div>
</div>
<div id="admonition-socket-vs-file" class="admonition note">
<div class="admonition-title">
<p>Socket vs. file</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/socket.html#admonition-socket-vs-file"></a></p>
</div>
<div>
<p>A socket is not a file.</p>
<p>However, it uses file-like semantics like file descriptors.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sock_stream"><a class="header" href="#sock_stream">SOCK_STREAM</a></h1>
<p>A socket of type <code>SOCK_STREAM</code> provides sequenced, reliable, full-duplex byte streams. </p>
<p>This correlated with TCP.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sock_dgram"><a class="header" href="#sock_dgram">SOCK_DGRAM</a></h1>
<p>A socket of type <code>SOCK_DGRAM</code> supports connectionless, unreliable (typically) small messages.</p>
<p>This correlates with UDP.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sock_raw"><a class="header" href="#sock_raw">SOCK_RAW</a></h1>
<p><code>SOCK_RAW</code> type sockets don't abstract some of the operations that <code>SOCK_STREAM</code> and <code>SOCK_DGRAM</code> offer like:</p>
<ul>
<li>Handling network interfaces</li>
<li>Handling packet construction</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="route-table-1"><a class="header" href="#route-table-1">Route table</a></h1>
<p>Maps a <strong>destination address</strong> to the <strong>gateway</strong> (i.e. next hop IP address) or <strong>host</strong> (intended destination), which is tied to a particular network interface.</p>
<div id="admonition-osi-model" class="admonition info">
<div class="admonition-title">
<p>OSI model</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/route-table.html#admonition-osi-model"></a></p>
</div>
<div>
<p>Routing is parked under OSI Layer 3.</p>
</div>
</div>
<p>This is maintained via a <strong>routing table</strong>:</p>
<div class="table-wrapper"><table><thead><tr><th>Destination</th><th>Gateway / Host</th><th>Network interface</th></tr></thead><tbody>
<tr><td>127.0.0.1</td><td>127.0.0.1</td><td>lo0</td></tr>
<tr><td>(others)</td><td>192.168.1.254 (home router)</td><td>en0</td></tr>
</tbody></table>
</div><div id="admonition-view-routing-table" class="admonition tip">
<div class="admonition-title">
<p>View routing table</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/route-table.html#admonition-view-routing-table"></a></p>
</div>
<div>
<p>You can see the routing table using</p>
<pre><code>netstat -rn
</code></pre>
<p>Output:</p>
<pre><code>Internet:
Destination        Gateway            Flags           Netif Expire
default            192.168.1.254      UGScg             en0
127                127.0.0.1          UCS               lo0
127.0.0.1          127.0.0.1          UH                lo0
169.254            link#5             UCS               en0      !
</code></pre>
<p>The headers have the following meaning:</p>
<ul>
<li><code>Destination</code>: The destination IP address or network. <code>Default</code> is the one that is used when no other route matches the destination IP address.</li>
<li><code>Gateway</code>: The next hop IP address that will be used to reach the destination. <code>link#X</code> refers to the index <code>X</code> of an interface when you run <code>ifconfig</code> on macOS.</li>
<li><code>Flags</code>: A set of flags that give more information about the route. For example, <code>U</code> means the route is up, <code>G</code> means to use this route as a gateway, <code>H</code> means the destination is a host, etc.</li>
<li><code>Refs</code>: The reference count (how many routes refer to this route).</li>
<li><code>Use</code>: The count of the number of packets sent using this route.</li>
<li><code>Netif</code>: The network interface used for this route.</li>
<li><code>Expire</code>: The time in seconds until the route expires (only used for some types of routes).</li>
</ul>
</div>
</div>
<div id="admonition-find-default-gateway" class="admonition tip">
<div class="admonition-title">
<p>Find default gateway</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/route-table.html#admonition-find-default-gateway"></a></p>
</div>
<div>
<p>In macOS, use <code>route</code>:</p>
<pre><code>route -n get default
</code></pre>
<p>In Linux:</p>
<pre><code>ip route show default
</code></pre>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="network-interfaces"><a class="header" href="#network-interfaces">Network interfaces</a></h1>
<p>This is a <em>software</em> abstraction of (but not limited to) physical network interfaces.</p>
<p>These interfaces are <em>logical</em> interfaces: they can be linked to either physical hardware interfaces (eg. Wi-Fi, Ethernet card) or software-based interfaces (eg. VPN tunnels, loop interface).</p>
<div id="admonition-osi-model" class="admonition info">
<div class="admonition-title">
<p>OSI model</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/interfaces.html#admonition-osi-model"></a></p>
</div>
<div>
<p>Network interface probably spans OSI Layers 1, 2 and 3.</p>
</div>
</div>
<p>Common types of network interfaces:</p>
<div class="table-wrapper"><table><thead><tr><th>Interface</th><th>Use</th></tr></thead><tbody>
<tr><td><code>en0</code></td><td>Usually Wi-Fi</td></tr>
<tr><td><code>enXXX</code></td><td>Ethernet</td></tr>
<tr><td><code>lo0</code></td><td>Loopback</td></tr>
<tr><td><code>p2p0</code></td><td>Apple's AirDrop</td></tr>
<tr><td><code>awdl0</code></td><td>Apple's AirDrop, SideCar</td></tr>
<tr><td><code>llw0</code></td><td>Apple's Low Data Mode</td></tr>
<tr><td><code>gif0</code>, <code>stf0</code></td><td>Tunnel interfaces</td></tr>
<tr><td><code>utunXXX</code></td><td>Interfaces for VPN</td></tr>
</tbody></table>
</div>
<ul>
<li>Hardware-based
<ul>
<li><strong>Wi-Fi interface</strong></li>
<li>Ethernet interface</li>
</ul>
</li>
<li>Software-based
<ul>
<li><strong>Loopback interface</strong> — special network interface used by a device to send <em>packets</em> to itself</li>
<li><code>utun</code> (VPN tunnel) — userspace tunnel; used in VPNs</li>
<li>Virtual Network Interface — used in containerisation software</li>
</ul>
</li>
</ul>
<div id="admonition-userspace-tunnel" class="admonition info">
<div class="admonition-title">
<p>Userspace tunnel</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/interfaces.html#admonition-userspace-tunnel"></a></p>
</div>
<div>
<p>The tunnel is created in the user space of the OS, instead of the kernel space.</p>
<p>This means the tunnel is managed by user-level process.</p>
</div>
</div>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/interfaces.html#admonition-tip"></a></p>
</div>
<div>
<p>In macOS, you can list the network interfaces:</p>
<pre><code class="language-sh">ifconfig
</code></pre>
<p>whereas in Linux it's</p>
<pre><code class="language-sh">ipconfig
</code></pre>
</div>
</div>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/interfaces.html#admonition-note"></a></p>
</div>
<div>
<p>You don't typically interact directly with network interfaces. The OS abstracts this away using sockets.</p>
</div>
</div>
<div id="admonition-tip-1" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/interfaces.html#admonition-tip-1"></a></p>
</div>
<div>
<p>Run <code>networkQuality</code> to run an Internet speed test from your Mac.</p>
</div>
</div>
<div id="admonition-tip-2" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/interfaces.html#admonition-tip-2"></a></p>
</div>
<div>
<p>To log all outgoing IP addresses from a specific network interface, do</p>
<pre><code class="language-sh">sudo tcpdump -i en0 -n -tttt
</code></pre>
</div>
</div>
<div id="admonition-tip-3" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/interfaces.html#admonition-tip-3"></a></p>
</div>
<div>
<p>A network interface is like a network configuration:</p>
<ul>
<li>IP address</li>
<li>Subnet mask</li>
<li>Default gateway</li>
<li>DNS servers</li>
</ul>
<p>Configurations are retrieved from a DHCP ssrver.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="network-interface-controller"><a class="header" href="#network-interface-controller">Network Interface Controller</a></h1>
<p>aka Network Interface Card, Network Adapter, hardware port, hardware interface</p>
<p>This is a hardware component that allows a device to connect to a network. An NIC controls the interaction between hardware and wired/optical/wireless medium.</p>
<div id="admonition-osi-model" class="admonition info">
<div class="admonition-title">
<p>OSI model</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/network-interface-card.html#admonition-osi-model"></a></p>
</div>
<div>
<p>NIC would map to OSI Layer 1.</p>
</div>
</div>
<p>A host can have multiple NICs.</p>
<p><strong>Every NIC has a physical address called MAC address</strong> (Media Access Control) which is a unique serial number. </p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/network-interface-card.html#admonition-note"></a></p>
</div>
<div>
<p>A typical MAC address is 6 octets long, eg. 00:0a:95:9d:68:16.</p>
</div>
</div>
<p>Here are some common NICs:</p>
<ul>
<li>Ethernet card</li>
<li>Wireless network card</li>
<li>Mobile network adapter</li>
<li>USB network adapter</li>
<li>Fiber Optic NIC</li>
</ul>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="software-hardware-layers/network-interface-card.html#admonition-tip"></a></p>
</div>
<div>
<p>In macOS, you can list all NICs and their MAC addresses:</p>
<pre><code>networksetup -listallhardwareports
</code></pre>
</div>
</div>
<hr />
<ul>
<li>Guided
<ul>
<li>Twisted pair copper wire (carry electrical signals)</li>
<li>Coaxial cable (carry electrical signals)</li>
<li>Fiber optics (carry light)
<ul>
<li>Multimode. Uses LED; works over 10km.</li>
<li>Monomode. Uses laser; works over a few km.</li>
</ul>
</li>
</ul>
</li>
<li>Unguided
<ul>
<li>Terrestrial radio channels (radio waves):
<ul>
<li>1-2 meters: Bluetooth</li>
<li>Up to 100 meters: WiFi</li>
<li>Up to kilomteres: 3G, 4G, LTE</li>
</ul>
</li>
<li>Free-space optical communication (light)</li>
</ul>
</li>
</ul>
<p>Metallic media suffer from electrical noise and interference from nearby electrical sources.</p>
<hr />
<p>Transmission and reception of raw bit streams over a physical medium. Conversion of signals.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vpn"><a class="header" href="#vpn">VPN</a></h1>
<p>The idea of a VPN can be extended to Cloudflare's edge.</p>
<ol>
<li>
<p><strong>VPN client establishes connection with VPN server</strong></p>
<p>This is made using the existing network interface. </p>
</li>
<li>
<p><strong>VPN client creates a new network interface</strong></p>
<p>The VPN client software will then serve as an intermediary between the newly created virtual network interface and the physical network interface.</p>
</li>
</ol>
<div id="admonition-why-cant-we-just-use-existing-network-interfaces" class="admonition question">
<div class="admonition-title">
<p>Why can't we just use existing network interfaces?</p>
<p><a class="admonition-anchor-link" href="vpn/index.html#admonition-why-cant-we-just-use-existing-network-interfaces"></a></p>
</div>
<div>
<p>Using a separate interface for the VPN allows for more precise control over network traffic and makes the implementation of the VPN features more straightforward.</p>
</div>
</div>
<ol start="3">
<li>
<p><strong>VPN server assigns an IP address to the new network interface</strong></p>
<p>The VPN server acts like a DHCP server.</p>
</li>
<li>
<p><strong>VPN client updates host routing table</strong></p>
</li>
<li>
<p><strong>VPN client updates DNS settings</strong></p>
</li>
<li>
<p><strong>VPN client encrypts data</strong></p>
</li>
<li>
<p><strong>VPN server decrypts data</strong></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ipsec"><a class="header" href="#ipsec">IPSec</a></h1>
<p>Secure network protocol suite that authenticates and encrypts packets of data.</p>
<p>Workflow:</p>
<ol>
<li>Key exchange and Security Association (?) — IKE/IKEv2</li>
<li>Authentication</li>
<li>Encryption of IP packet payload</li>
<li>Encrypt IP header or not</li>
<li>Decryption</li>
</ol>
<div id="admonition-example" class="admonition example">
<div class="admonition-title">
<p>Example</p>
<p><a class="admonition-anchor-link" href="vpn/ipsec.html#admonition-example"></a></p>
</div>
<div>
<p>Cisco AnyConnect Secure Mobility Client uses IPSec for its VPN connections.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ikev2"><a class="header" href="#ikev2">IKEv2</a></h1>
<p>IKEv2 is a protocol to securely establish, negotiate, modify and delete SAs.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="openvpn"><a class="header" href="#openvpn">OpenVPN</a></h1>
<p>OpenVPN is a protocol for VPNs.</p>
<p>It works by creating a secure connection between two points (&quot;tunnel&quot;).</p>
<p>Workflow:</p>
<ol>
<li>
<p>TLS handshake</p>
</li>
<li>
<p>Authentication</p>
</li>
<li>
<p>Negotiate session key</p>
</li>
<li>
<p>Tunnelling (encryption &amp; decryption)</p>
<p>The original IP packet is encrypted and becomes the payload of a new IP packet. The header in the new IP packet has the VPN server as its destination.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wireguard"><a class="header" href="#wireguard">WireGuard</a></h1>
<div id="admonition-example" class="admonition example">
<div class="admonition-title">
<p>Example</p>
<p><a class="admonition-anchor-link" href="vpn/wireguard.html#admonition-example"></a></p>
</div>
<div>
<p>Cloudflare Warp</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="split-tunnelling"><a class="header" href="#split-tunnelling">Split tunnelling</a></h1>
<p>When you partition your traffic into:</p>
<ol>
<li>which traffic goes into the VPN tunnel</li>
<li>which traffic accesses the internet directly</li>
</ol>
<p>This is done for performance reasons, because not all traffic needs to go through the VPN.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="layer-7---application"><a class="header" href="#layer-7---application">Layer 7 - Application</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="http"><a class="header" href="#http">HTTP</a></h1>
<p>Hypertext Transfer Protocol</p>
<p>HTTP is a client-server application layer protocol.</p>
<p>HTTP/2 and earlier use TCP as its underlying transport protocol so that messages are guaranteed to get delivered in order. A connection must first be made.</p>
<hr />
<h2 id="types-of-http-connections"><a class="header" href="#types-of-http-connections">Types of HTTP connections</a></h2>
<ul>
<li>Non-persistent HTTP connections
<ol>
<li>The client initiates a TCP connection with a server.</li>
<li>The client sends an HTTP request to the server.</li>
<li>The server retrieves the requested resource from its storage etc. and sends it back to the client.</li>
<li>THe client receives the resource, say an HTML. If that file has references to more resources, steps 1-4 are repeated for each of those.</li>
<li>The server closes the TCP connection.</li>
</ol>
</li>
<li>Persistent HTTP connections
Because an HTTP session typically involves multiple non-persistent HTTP connections, the TCP connections which are established and torn down multiple times are inefficient. Persistent HTTP connections are developed such that the duration of the time before the server closes the connection is configurable. Hence, only 1 TCP connection is used to serve multiple requests.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="message-format"><a class="header" href="#message-format">Message format</a></h1>
<h2 id="http-methods"><a class="header" href="#http-methods">HTTP methods</a></h2>
<ul>
<li>GET</li>
<li>POST</li>
<li>HEAD</li>
<li>DELETE</li>
<li>PUT</li>
<li>OPTIONS
<ul>
<li>Identify allowed request methods (eg. GET etc.). Response contains an <code>Allow</code> header.</li>
<li>Preflighted requests in CORS</li>
</ul>
</li>
</ul>
<h2 id="http-headers"><a class="header" href="#http-headers">HTTP headers</a></h2>
<h3 id="request-headers"><a class="header" href="#request-headers">Request headers</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Header</th><th>What it means</th><th>Example</th></tr></thead><tbody>
<tr><td>Host</td><td>Domain</td><td><code>example.com</code></td></tr>
<tr><td>User-Agent</td><td>Name of HTTP client</td><td></td></tr>
<tr><td>Authorization</td><td>Field for authentication etc.</td><td></td></tr>
<tr><td>Content-Type</td><td>MIME type of body</td><td><code>application/json</code></td></tr>
<tr><td>Content-Length</td><td>Length of body in bytes</td><td><code>34</code></td></tr>
<tr><td>Referer</td><td>???</td><td><code>http://example.com</code></td></tr>
<tr><td>Accept</td><td>MIME type for the response</td><td><code>image/png</code></td></tr>
<tr><td>Connection</td><td>Keep TCP connection open</td><td><code>close</code>, <code>keep-alive</code></td></tr>
<tr><td>Cookie</td><td>-</td><td><code>user=raimi</code></td></tr>
</tbody></table>
</div>
<h3 id="response-headers"><a class="header" href="#response-headers">Response headers</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Header</th><th>What it means</th><th>Example</th></tr></thead><tbody>
<tr><td>Set-Cookie</td><td>Set a cookie</td><td><code>user=raimi; HttpOnly</code></td></tr>
<tr><td>Content-Type</td><td>MIME type of body</td><td><code>application/json</code></td></tr>
<tr><td>Content-Length</td><td>Length of body in bytes</td><td><code>34</code></td></tr>
<tr><td>Date</td><td>When response was sent</td><td><code>Thu, 29 Jun 2023 15:08:47 GMT</code></td></tr>
<tr><td>Last-Modified</td><td>When content was last modified</td><td><code>Thu, 29 Jun 2023 15:08:47 GMT</code></td></tr>
<tr><td>Connection</td><td>Keep TCP connection open?</td><td><code>close</code>, <code>keep-alive</code></td></tr>
</tbody></table>
</div>
<h3 id="security-headers"><a class="header" href="#security-headers">Security headers</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Header</th><th>What it means</th><th>Example</th></tr></thead><tbody>
<tr><td>Strict-Transport-Security</td><td>Load website in HTTPS?</td><td><code>max-age=31536000 includeSubDomains</code></td></tr>
<tr><td>Content-Security-Policy</td><td>Load assets?</td><td></td></tr>
<tr><td>X-Frame-Options</td><td>Can website be framed?</td><td><code>DENY</code>, <code>SAMEORIGIN</code>, <code>ALLOW-FROM https://example.com</code></td></tr>
<tr><td>X-Content-Type-Options</td><td>MIME-sniff resource?</td><td><code>nosniff</code></td></tr>
<tr><td>Referrer-Policy</td><td>??</td><td><code>no-referrer</code></td></tr>
</tbody></table>
</div><div id="admonition-cookie" class="admonition note">
<div class="admonition-title">
<p>Cookie</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/http/message-format.html#admonition-cookie"></a></p>
</div>
<div>
<p>Cookies are unique string identifiers that can be stored on the client’s browser to keep track of client’s state (for the purpose of logging in, serving customised content). They are set by the server through HTTP headers. After the cookie is set, it’s sent along with subsequent HTTP requests to the same server to allow the server to know who is contacting it.</p>
<p>Things involved in the process of setting and using cookies: HTTP request, HTTP response, cookie file on the client’s browser and the database of cookie-user values on the server</p>
<p>Cookie file contains:</p>
<ul>
<li>Website’s domain</li>
<li>String value of cookie</li>
<li>Date that cookie expires</li>
</ul>
<pre><code>Set cookie: session=44ecb091; path=/servlets
</code></pre>
<p>Note: 3rd party cookies are cookies set for domains that are not being visited. Blocking them is not enough due to several workarounds like respawning cookies etc.</p>
</div>
</div>
<ul>
<li>Content-Security-Policy: XSS, data injection</li>
<li>X-Frame-Options: Clickjacking</li>
<li>X-Content-Type-Options: XSS</li>
<li>Referrer-Policy: Privacy</li>
</ul>
<p>Resources:</p>
<ul>
<li><a href="https://securityheaders.com/">https://securityheaders.com</a></li>
<li><a href="https://report-uri.com/home/analyse/">https://report-uri.com/home/analyse/</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="features"><a class="header" href="#features">Features</a></h1>
<p>HTTP/2: <a href="https://tools.ietf.org/html/rfc7540">RFC 7540</a></p>
<div class="table-wrapper"><table><thead><tr><th>Feature</th><th>HTTP/3</th><th>HTTP/2</th><th>HTTP/1.1</th><th>HTTP/1.0</th></tr></thead><tbody>
<tr><td>Transport protocol</td><td>QUIC</td><td>TCP</td><td>TCP</td><td>TCP</td></tr>
<tr><td>Format</td><td>Binary</td><td>Binary</td><td>Text</td><td>Text</td></tr>
<tr><td>Concurreny</td><td>✅</td><td>✅</td><td>❌</td><td>❌</td></tr>
<tr><td>Server push</td><td>✅</td><td>✅</td><td>❌</td><td>❌</td></tr>
<tr><td>Stream prioritisation</td><td>✅</td><td>✅</td><td>❌</td><td>❌</td></tr>
<tr><td>Header compression</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr>
<tr><td>Single TCP connection^</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr>
</tbody></table>
</div><div id="admonition-binary-format" class="admonition question">
<div class="admonition-title">
<p>Binary format</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/http/features.html#admonition-binary-format"></a></p>
</div>
<div>
<p>A binary protocol means that the data becomes more compact (and closer to how the data is represented in memory), hence more efficient parsing.</p>
</div>
</div>
<div id="admonition-single-tcp-connection" class="admonition question">
<div class="admonition-title">
<p>Single TCP connection</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/http/features.html#admonition-single-tcp-connection"></a></p>
</div>
<div>
<p>All communication between a client and a server takes place over a <em>single</em> TCP connection, lasting for the duration of the client's session.</p>
<p>This reduces the overhead of setting up and tearing down connections for each interaction.</p>
<ul>
<li>System call overhead</li>
<li>TCP handshake</li>
<li>TCP congestion control</li>
<li>TLS overhead (HTTPS)</li>
</ul>
</div>
</div>
<div id="admonition-concurrency" class="admonition question">
<div class="admonition-title">
<p>Concurrency</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/http/features.html#admonition-concurrency"></a></p>
</div>
<div>
<p>Suppose a client has made 2 requests (&quot;streams&quot;) to the server over the same TCP connection.</p>
<p>Instead of the server responding to stream 1 fully (all frames), then stream 2 (all frames),</p>
<pre class="mermaid">sequenceDiagram
    client -&gt;&gt; server: stream 1
    client -&gt;&gt; server: stream 2
    server -&gt;&gt; client: stream 1 frame 1
    server -&gt;&gt; client: stream 1 frame 2
    server -&gt;&gt; client: stream 2 frame 1
    server -&gt;&gt; client: stream 2 frame 2
    server -&gt;&gt; client: stream 2 frame 3
</pre>
<p>the server can <em>interleave</em> (&quot;multiplex&quot;) the frames between different streams.</p>
<pre class="mermaid">sequenceDiagram
    client -&gt;&gt; server: stream 1
    client -&gt;&gt; server: stream 2
    server -&gt;&gt; client: stream 1 frame 1
    server -&gt;&gt; client: stream 2 frame 1
    server -&gt;&gt; client: stream 1 frame 2
    server -&gt;&gt; client: stream 2 frame 2
    server -&gt;&gt; client: stream 2 frame 3
</pre>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="http-tunnel"><a class="header" href="#http-tunnel">HTTP tunnel</a></h1>
<p>Encapsulating another protocol's data using HTTP</p>
<p>This involves 3 components:</p>
<ul>
<li>Client — Initiates the communication with the encapsulated data in HTTP request</li>
<li>Proxy server — Decapsulates the data and forwards it to the server</li>
<li>Server</li>
</ul>
<p>The <code>HTTP CONNECT</code> method is often used to set up an HTTP tunnel.</p>
<p>A common protocol that is being tunnelled is HTTPS (aka TLS tunnel):</p>
<ol>
<li>
<p><strong>Client sends an HTTP CONNECT request to proxy server</strong></p>
</li>
<li>
<p><strong>Proxy server opens a TCP/IP connection to the desired server</strong></p>
<p>At the same time, the proxy server sends an HTTP 200 OK response back to the client</p>
</li>
<li>
<p><strong>Client starts a TLS handshake with the web server</strong></p>
<p>Note that the request is sent through the open connection on the proxy server. The proxy server simply relays the data.</p>
</li>
<li>
<p><strong>Once TLS handshake is complete, the client and the server can securely exchange HTTP requests and responses</strong></p>
</li>
</ol>
<div id="admonition-on-using-http-connect" class="admonition note">
<div class="admonition-title">
<p>On using HTTP CONNECT</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/http/tunnel.html#admonition-on-using-http-connect"></a></p>
</div>
<div>
<p>HTTP clients automatically uses the HTTP CONNECT method (transparent to user) when it detects that it is connected to a proxy server.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="browser"><a class="header" href="#browser">Browser</a></h1>
<p>The browser is an HTTP client.</p>
<div id="admonition-assets" class="admonition note">
<div class="admonition-title">
<p>Assets</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/http/browser.html#admonition-assets"></a></p>
</div>
<div>
<p>(eg. documents, CSS, JavaScript)</p>
</div>
</div>
<div id="admonition-frame" class="admonition note">
<div class="admonition-title">
<p>Frame</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/http/browser.html#admonition-frame"></a></p>
</div>
<div>
<p>???</p>
</div>
</div>
<div id="admonition-mime-sniffing" class="admonition note">
<div class="admonition-title">
<p>MIME-sniffing</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/http/browser.html#admonition-mime-sniffing"></a></p>
</div>
<div>
<p>MIME-sniffing happens (for some web browsers) to determine the content of an asset. Specific to IE and Chrome. With clever naming, a resource can be determined to be an HTML document which has malicious script.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="https"><a class="header" href="#https">HTTPS</a></h1>
<p>HTTP + TLS</p>
<p><img src="osi-layer-7/./ssl.png" alt="SSL" /></p>
<p><img src="osi-layer-7/./https.png" alt="HTTPS" /></p>
<ol>
<li>Browser visits an https website</li>
<li>Server replies</li>
<li>Server sends back a cert</li>
<li>Server key exchange, server gives client public key</li>
<li>
<ul>
<li></li>
</ul>
</li>
</ol>
<p>Browser then verifies:
1. Checks if hostname in cert is same as URL
2. Checks if CA is valid
3. Checks if cert is expired</p>
<ol>
<li>Browser and server creating a <strong>symmetric key</strong> (&quot;session key&quot;) that can be used for encrypting future data.</li>
<li>
<ul>
<li></li>
</ul>
</li>
<li>
<ul>
<li></li>
</ul>
</li>
<li>
<ul>
<li></li>
</ul>
</li>
<li>Browser and server created a <strong>symmetric key</strong> (&quot;session key&quot;) that can be used for encrypting future data.</li>
</ol>
<div id="admonition-see-a-servers-ssl-cert" class="admonition tip">
<div class="admonition-title">
<p>See a server's SSL cert</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/https.html#admonition-see-a-servers-ssl-cert"></a></p>
</div>
<div>
<pre><code>openssl s_client -connect jvns.ca:443 -servername jvns.ca
</code></pre>
</div>
</div>
<h2 id="resources"><a class="header" href="#resources">Resources:</a></h2>
<ul>
<li>
<p><a href="https://decoder.link/sslchecker/">https://decoder.link/sslchecker/</a></p>
</li>
<li>
<p><a href="https://www.cloudflare.com/learning/ssl/how-does-ssl-work/">https://www.cloudflare.com/learning/ssl/how-does-ssl-work/</a></p>
</li>
<li>
<p><a href="https://www.thesslstore.com/blog/how-does-https-work/">https://www.thesslstore.com/blog/how-does-https-work/</a></p>
</li>
<li>
<p><a href="https://www.ssllabs.com/ssltest/analyze.html">https://www.ssllabs.com/ssltest/analyze.html</a></p>
</li>
<li>
<p><a href="https://hstspreload.org/">https://hstspreload.org/</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/a/67197597/4570466">https://stackoverflow.com/a/67197597/4570466</a></p>
</li>
<li>
<p><a href="https://howhttps.works/">https://howhttps.works</a></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ssh"><a class="header" href="#ssh">SSH</a></h1>
<p>Secure Shell</p>
<p>SSH is built on top of TCP.</p>
<p>This protocol provides a secure way to access a remote computer via shell. The establishment of a secure communication is part of SSH (Layer 6).</p>
<div id="admonition-ssh-across-multiple-osi-layers" class="admonition tip">
<div class="admonition-title">
<p>SSH across multiple OSI layers</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/ssh.html#admonition-ssh-across-multiple-osi-layers"></a></p>
</div>
<div>
<p>SSH spans across layers 5, 6 and 7.</p>
</div>
</div>
<div id="admonition-ssh-implementations" class="admonition info">
<div class="admonition-title">
<p>SSH implementations</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/ssh.html#admonition-ssh-implementations"></a></p>
</div>
<div>
<ul>
<li>OpenSSH (macOS)</li>
<li>PuTTY (Windows, Linux)</li>
</ul>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dns"><a class="header" href="#dns">DNS</a></h1>
<p>Domain Name System</p>
<p>DNS is a client-server application layer protocol that translates hostnames on the Internet to IP addresses. DNS is a server and a database.</p>
<p>A hostname is also known as a DNS hostname.</p>
<div id="admonition-dns-servers" class="admonition tip">
<div class="admonition-title">
<p>DNS servers</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/dns/index.html#admonition-dns-servers"></a></p>
</div>
<div>
<p>Amazon Route 53, 1.1.1.1, 8.8.8.8</p>
</div>
</div>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/dns/index.html#admonition-note"></a></p>
</div>
<div>
<p>Devices within the network get their DNS server settings from the router either manually or via (DHCP).</p>
</div>
</div>
<div id="admonition-hosts-file" class="admonition tip">
<div class="admonition-title">
<p>Hosts file</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/dns/index.html#admonition-hosts-file"></a></p>
</div>
<div>
<p>The hosts file is a simple text file that maps hostnames to IP addresses. It is checked before DNS is used, so entries in your hosts file will override DNS. </p>
<pre><code>cat /etc/hosts
</code></pre>
</div>
</div>
<p>Get my DNS server</p>
<pre><code>cat /etc/resolv.conf   
</code></pre>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/dns/index.html#admonition-tip"></a></p>
</div>
<div>
<p>prints the DNS servers for the specified network service.
networksetup -getdnsservers <networkservice></p>
</div>
</div>
<p>where nameserver is the local dns server</p>
<p>The computer has a Local resolver library to cache DNS mappings.</p>
<p>or</p>
<pre><code>nslookup &lt;anywebsite&gt;
</code></pre>
<p>Query DNS records</p>
<pre><code>nslookup                       
    -type=A/mx &lt;website&gt;
    -debug &lt;website&gt; 
host -t a/ns/mx &lt;website&gt;
dig @8.8.8.8 jvns.ca   @ means querying a 8.8.8.8 DNS server
dig +trace jvns.ca     Works like recursive DNS server
time dig @1.1.1.1 twitter.com
time dig @8.8.8.8 twitter.com
</code></pre>
<p>Reverse DNS lookup</p>
<pre><code>dig -x 172.17.13.217
</code></pre>
<p>Chrome DNS lookup</p>
<p>chrome://net-internals/#dns</p>
<div id="admonition-on-dns-propagation" class="admonition info">
<div class="admonition-title">
<p>On 'DNS propagation'</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/dns/index.html#admonition-on-dns-propagation"></a></p>
</div>
<div>
<p>&quot;DNS propagation&quot; is a misleading term. </p>
<p>You're not actually waitinf for DNS records to propagate, you're waiting for cached records to expire.</p>
</div>
</div>
<h1 id="dns-as-distributed-hierarchical-database"><a class="header" href="#dns-as-distributed-hierarchical-database"><strong>DNS as distributed hierarchical database</strong></a></h1>
<p>The DNS database is distributed</p>
<ul>
<li>To avoid single point of failure</li>
<li>To handle massive amounts of traffic</li>
<li>To make it closer to certain locations</li>
<li>To handle different domain hierarchies</li>
</ul>
<h1 id="anatomy-of-domain-name"><a class="header" href="#anatomy-of-domain-name"><strong>Anatomy of domain name</strong></a></h1>
<p>discuss.educative.io</p>
<pre><code>&lt;sub-domain&gt;.&lt;second level domain&gt;.&lt;top-level domain&gt;
</code></pre>
<h1 id="types-of-dns-servers"><a class="header" href="#types-of-dns-servers"><strong>Types of DNS servers</strong></a></h1>
<ul>
<li>Authoritative nameserver: source of truth</li>
<li>DNS recursor (eg. 8.8.8.8)</li>
</ul>
<h1 id="dns-1"><a class="header" href="#dns-1"><strong>DNS</strong></a></h1>
<p>Point of contact for DNS query</p>
<ol>
<li>Local DNS cache (local resolver library)</li>
<li>DNS recursor (eg. hosted by ISP or 1.1.1.1)</li>
<li>Root nameservers</li>
<li>TLD nameservers (.edu server) and sub-domain nameservers (cs.stanford.edu server)</li>
<li>Authoritative nameservers (stanford.edu server) (last stop)</li>
</ol>
<p><img src="osi-layer-7/dns/dns.png" alt="DNS" /></p>
<h1 id="dns-records--resource-records"><a class="header" href="#dns-records--resource-records"><strong>DNS records / resource records</strong></a></h1>
<p>A DNS record is a list of mappings of hostname to IP address. An entry has the format:</p>
<pre><code>(name, value, type, ttl)
</code></pre>
<p>where TTL (time-to-live) specifies how long the entry can be cached by the client. The values of “name”, “value”, and “type” vary from record types.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="record-types"><a class="header" href="#record-types">Record types</a></h1>
<h2 id="a-record-address-record"><a class="header" href="#a-record-address-record">A Record (Address Record)</a></h2>
<p>Associates a domain name or subdomain with an IPv4 address (32-bit / 4 bytes / 4 octets).</p>
<pre><code>name            host    value         
------------------------------------
educative.io    @       104.20.7.183
</code></pre>
<h2 id="cname-record-canonical-name"><a class="header" href="#cname-record-canonical-name">CNAME Record (Canonical Name)</a></h2>
<p>Associates a domain name with an alias of another canonical name.</p>
<pre><code>host    value (canonical name)       
------------------------------
www     educative.io
</code></pre>
<h2 id="mx-record"><a class="header" href="#mx-record">MX Record</a></h2>
<p>An MX (Mail) record is used to direct email to a specific mail server. Like a CNAME record, MX entries must point to a host name and should not be pointed directly to an IP address.</p>
<pre><code>name=hostname
value=mailserver associated with host
type=MX
</code></pre>
<h2 id="ns-record-dns-name-server"><a class="header" href="#ns-record-dns-name-server">NS Record (DNS name server)</a></h2>
<p>What DNS servers have the records for that domain?</p>
<pre><code>name=
value=
type=
ttl=
</code></pre>
<h2 id="aaaa-record-quad-a-record"><a class="header" href="#aaaa-record-quad-a-record">AAAA Record (“quad-A” record)</a></h2>
<p>IPv6 (8 bytes)</p>
<pre><code>name=
value=
type=
ttl=
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="doh"><a class="header" href="#doh">DoH</a></h1>
<p>DNS over HTTPS</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sftp"><a class="header" href="#sftp">SFTP</a></h1>
<p>SSH File Transfer Protocol</p>
<p>This protocol provides file transfer, file access and file management functionalities over any reliable data stream.</p>
<p>SFTP typically uses SSH (Layer 6) to secure the data stream.</p>
<div id="admonition-on-using-ssh" class="admonition note">
<div class="admonition-title">
<p>On using SSH</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/sftp.html#admonition-on-using-ssh"></a></p>
</div>
<div>
<p>Note that SFTP uses the part on secure communication provided by SSH (Layer 6). It doesn't use the remote shell access capabilities of SSH.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="websocket"><a class="header" href="#websocket">WebSocket</a></h1>
<p><a href="https://datatracker.ietf.org/doc/html/rfc6455">RFC 6455</a></p>
<p><code>ws://</code></p>
<p>WebSocket is built on top of TCP.</p>
<p>A WebSocket connection is a full-duplex connection.</p>
<p>The connection is established <strong>by upgrading an existing HTTP or HTTPS connection</strong>. As such it uses port 80 or 443. </p>
<div id="admonition-upgrading-an-http-connection" class="admonition tip">
<div class="admonition-title">
<p>Upgrading an HTTP connection</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/websocket.html#admonition-upgrading-an-http-connection"></a></p>
</div>
<div>
<p>Upgrading an HTTP connection might look like this:</p>
<pre><code>HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
</code></pre>
</div>
</div>
<div id="admonition-example-applications" class="admonition example">
<div class="admonition-title">
<p>Example applications</p>
<p><a class="admonition-anchor-link" href="osi-layer-7/websocket.html#admonition-example-applications"></a></p>
</div>
<div>
<p>A WebSocket connection is preferred when we need a persistent bi-directional low latency data flow from the client to the server and back.</p>
<p>Chat apps, real-time social streams, browser-based multiplayer games.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="websocket-secure"><a class="header" href="#websocket-secure">WebSocket Secure</a></h1>
<p>WebSocket that is secured with TLS is typically referred to as WebSocket Secure.</p>
<p>Commonly used with <code>wss://</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="telnet"><a class="header" href="#telnet">Telnet</a></h1>
<p>Protocol to estable virtual terminal connection to remote host. Note that Telnet can be used to connect to any port on a remote host.</p>
<p>Telnet runs on top of TCP.</p>
<p>Type</p>
<pre><code>telnet example.com 80
</code></pre>
<p>and</p>
<pre><code>GET / HTTP/1.1
Host: www.example.com
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bgp"><a class="header" href="#bgp">BGP</a></h1>
<p>Border Gateway Protocol</p>
<p>When a router receives a packet, it uses a protocol called BGP to decide what router the packet should go to next.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dhcp"><a class="header" href="#dhcp">DHCP</a></h1>
<p>Dynamic Host Configuration Protocol</p>
<p>A DHCP server provides the <strong>network configurations</strong> to its client:</p>
<ul>
<li>IP address</li>
<li>Subnet mask</li>
<li>Default gateway</li>
<li>DNS servers</li>
</ul>
<p>port: 67</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pop-imap"><a class="header" href="#pop-imap">POP, IMAP</a></h1>
<p>Post Office Protocol v3, Internet Message Access Protocol</p>
<p>POP/IMAP protocols are pull protocols used for getting email from an email server.</p>
<p>These protocols use TLS for security.</p>
<h1 id="pop"><a class="header" href="#pop"><strong>POP</strong></a></h1>
<p>POP phases</p>
<ol>
<li>User agent connects to POP server on TCP on port 110.</li>
<li>User agent authenticates.</li>
<li>User retrieves emails and mark emails for deletion.</li>
<li>Close the POP3 session. Server makes updates based on users command. Deletes email accordingly. Only inbox.</li>
</ol>
<p>Emails might not be in sync on multiple devices.</p>
<h1 id="imap"><a class="header" href="#imap"><strong>IMAP</strong></a></h1>
<p>(More complex)</p>
<ul>
<li>Emails are kept on the server and not deleted.</li>
<li>All folders are synced.</li>
<li>Inbox will be in sync on all devices.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="smtp"><a class="header" href="#smtp">SMTP</a></h1>
<p>Simple Mail Transfer Protocol (Sending Mail To People)</p>
<p>SMTP is a push protocol, used to send email out to the SMTP server whenever it needs to. SMTP uses TCP, which means that transfers are reliable. Connection is established at port 25.</p>
<ol>
<li>
<p>Email is sent to sender’s SMTP server.</p>
</li>
<li>
<p>Email is now placed on a message queue in the sending SMTP server.</p>
</li>
<li>
<p>Sender’s SMTP initiates a connection with the recipient’s SMTP server an will conduct an initial SMTP handshake.</p>
</li>
<li>
<p>Sender’s SMTP  the email to recipient’s SMTP server.</p>
<p>sends</p>
</li>
<li>
<p>Using a pull protocol, email is then downloaded from the recipient’s SMTP server.</p>
</li>
</ol>
<p><img src="osi-layer-7/./smtp.png" alt="SMTP" /></p>
<h1 id="format"><a class="header" href="#format"><strong>Format</strong></a></h1>
<p>Note: All SMTP email messages are in 7-bit ASCII</p>
<pre><code>Delivered-To: user@gmail.com
Date: Thu, 16 May 2019 03:36:28 +0000 (UTC)
From: Fahim from Educative &lt;fahim+newsletter@educative.io&gt;
Mime-Version: 1.0
Reply-to: fahim@educative.io
Subject: Data analysis with R
To: user@gmail.com
 
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain; charset=UTF-8
Mime-Version: 1.0
 
Hey User,
 
Regards,
Raimi
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tor"><a class="header" href="#tor">Tor</a></h1>
<p>The Onion Router</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="icloud-private-relay"><a class="header" href="#icloud-private-relay">iCloud Private Relay</a></h1>
<p><a href="https://blog.cloudflare.com/icloud-private-relay/">iCloud Private Relay</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tls"><a class="header" href="#tls">TLS</a></h1>
<p>Transport Layer Security</p>
<p>Previously known as SSL (Secure Sockets Layer)</p>
<p>TLS <em>typically</em> operates on top of TCP.</p>
<p>This protocol provides</p>
<ul>
<li><strong>Privacy</strong> — data is encrypted</li>
<li><strong>Data integrity</strong> — verifying data is not tampered with before reaching its intended recipient</li>
<li><strong>(Server) authentication</strong> — make sure when the client connects to the server, the server is indeed who it is</li>
</ul>
<div id="admonition-client-_and_-server-authentication" class="admonition note">
<div class="admonition-title">
<p>Client <em>and</em> server authentication</p>
<p><a class="admonition-anchor-link" href="osi-layer-6/tls/index.html#admonition-client-_and_-server-authentication"></a></p>
</div>
<div>
<p>While server authentication is the most common, the client can also be additionally requested for authentication. This is known as <strong>mTLS</strong> or mutual TLS.</p>
</div>
</div>
<h2 id="references"><a class="header" href="#references">References:</a></h2>
<ul>
<li><a href="https://tls13.xargs.org/">https://tls13.xargs.org/</a> (Visualisation)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup-trust-chain"><a class="header" href="#setup-trust-chain">Setup: Trust chain</a></h1>
<p>For this protocol to work, we rely on the trust infrastructure of the web.</p>
<p>The trust infrastructure is made up CAs (<strong>certificate authorities</strong>) and <strong>SSL certificates</strong>.</p>
<div id="admonition-examples-of-cas" class="admonition example">
<div class="admonition-title">
<p>Examples of CAs</p>
<p><a class="admonition-anchor-link" href="osi-layer-6/tls/trust-chain.html#admonition-examples-of-cas"></a></p>
</div>
<div>
<p>Let's Encrypt, DigiCert, Sectigo, GlobalSign</p>
</div>
</div>
<p>A (root) CA generates a certificate for itself, and certificates for servers and other CAs (&quot;intermediary CAs&quot;).</p>
<p>A CA can in turn generate certificates for other servers and other CAs and so on.</p>
<p>If a client needs to verify a server's certificate, it can check the chain of trust up to the root. If the chain leads back to a root that the client trusts, it can trust the server's certificate.</p>
<div id="admonition-clients-only-need-to-store-root-certificates" class="admonition tip">
<div class="admonition-title">
<p>Clients only need to store root certificates</p>
<p><a class="admonition-anchor-link" href="osi-layer-6/tls/trust-chain.html#admonition-clients-only-need-to-store-root-certificates"></a></p>
</div>
<div>
<p>It is easier for a client to manage a list of <em>root</em> certificates, rather than managing individual CA certs.</p>
</div>
</div>
<div id="admonition-trust-store" class="admonition info">
<div class="admonition-title">
<p>Trust store</p>
<p><a class="admonition-anchor-link" href="osi-layer-6/tls/trust-chain.html#admonition-trust-store"></a></p>
</div>
<div>
<p>Operating systems and browsers come with a list of trusted root certificates (&quot;<strong>trust store&quot;</strong>).</p>
<p>In macOS, the Keychain Access app lets you see the root certificates that macOS trusts by default under <strong>System Roots</strong>.</p>
<p>Some applications (eg. Java, IntelliJ) have their own trust store independent of the OS. For example, in Java, the trust store is typically found in a file name <strong>cacerts</strong> in the Java installation directory.</p>
</div>
</div>
<div id="admonition-how-to-add-root-certificates-to-trust-store" class="admonition question">
<div class="admonition-title">
<p>How to add root certificates to trust store?</p>
<p><a class="admonition-anchor-link" href="osi-layer-6/tls/trust-chain.html#admonition-how-to-add-root-certificates-to-trust-store"></a></p>
</div>
<div>
<p>The documentation for <a href="https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/user-side-certificates/install-cloudflare-cert/">Install the Cloudflare certificate</a> has a good overview to install the root certificate for OSes (macOS, iOS) and applications (Python, JetBrains).</p>
</div>
</div>
<h2 id="certificate-verification"><a class="header" href="#certificate-verification">Certificate verification</a></h2>
<p>How does the client verify a certificate?</p>
<ul>
<li>hostname matching (against the requested URL)</li>
<li>certificate validity</li>
<li>CA issuer</li>
<li>the client validates the:</li>
<li><strong>certificate signature</strong> — use the public key of the issuing CA to verify that the certificate has not been tampered with</li>
<li><strong>certificate chain</strong> — if the issuing CA is an intermediate CA, get the intermediate CA's certificate and repeat the steps above. if it's a root CA, verify against the OS trust store.</li>
</ul>
<div id="admonition-how-to-show-certificates-of-intermediate-cas" class="admonition question">
<div class="admonition-title">
<p>How to show certificates of intermediate CAs?</p>
<p><a class="admonition-anchor-link" href="osi-layer-6/tls/trust-chain.html#admonition-how-to-show-certificates-of-intermediate-cas"></a></p>
</div>
<div>
<p>The server typically sends its own certificate and the intermediate CA's certificates as well. </p>
<p>In OpenSSL, use the <code>-showcerts</code> option.</p>
<pre><code>openssl s_client -showcerts -servername jvns.ca -connect jvns.ca:443 2&gt;/dev/null
</code></pre>
<p>In a Chrome browser, you can see the chain when you click the padlock.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup-client-server"><a class="header" href="#setup-client-server">Setup: Client-server</a></h1>
<p>For this protocol to work,</p>
<ul>
<li>the server must have an <strong>SSL certificate</strong></li>
<li>the client must have a <strong>the corresponding root CA's certificate</strong></li>
</ul>
<p>There are also 3 entities at play:</p>
<ol>
<li>the server</li>
<li>the client</li>
<li>the CA</li>
</ol>
<h2 id="1-the-server-must-have-an-ssl-certificate"><a class="header" href="#1-the-server-must-have-an-ssl-certificate">1. The server must have an SSL certificate</a></h2>
<p>This is an X.509 certificate.</p>
<ul>
<li>the server hostname(s)</li>
<li>a public key </li>
<li>an expiration date</li>
<li>signature(s) from a CA (signed with their private key)</li>
</ul>
<p>This certificate is issued <em>out-of-band</em> by a CA.</p>
<p>There are two ways to obtain an SSL certificate:</p>
<ul>
<li>via CSR -- manual way</li>
<li>via ACME (Automatic Certificate Management Environment) -- a modern, automated way</li>
</ul>
<div id="admonition-via-csr" class="admonition note">
<div class="admonition-title">
<p>via CSR</p>
<p><a class="admonition-anchor-link" href="osi-layer-6/tls/setup.html#admonition-via-csr"></a></p>
</div>
<div>
<p>To request for an SSL certificate from a CA, the owner of the server needs to submit a <strong>Certificate Signing Request</strong> (CSR) to the CA. The workflow is as such:</p>
<ol>
<li>The server generates a key pair.</li>
<li>Generate a CSR using the private key. A CSR requests information like:
<ul>
<li>the server hostname</li>
<li>public key (gotten from private key)</li>
<li>company details</li>
<li>country</li>
</ul>
</li>
<li>Submit the CSR to the CA.</li>
<li>The CA validates the domain ownership (via DCV etc.).</li>
</ol>
<p>Once validated, the CA will issue the SSL certificate to the owner of the server (via email etc.).</p>
</div>
</div>
<h2 id="2-the-client-must-have-the-corresponding-root-cas-certificate"><a class="header" href="#2-the-client-must-have-the-corresponding-root-cas-certificate">2. The client must have the corresponding root CA's certificate</a></h2>
<p>The client needs to trust the CA that issued the server's certificate.</p>
<p>To do that, the client needs to have the corresponding CA certificate or the root CA (usually this).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tls-cipher-suite"><a class="header" href="#tls-cipher-suite">TLS cipher suite</a></h1>
<p>A cipher suite specifies the methods and algorithms that a TLS client and server will use to securely communicate.</p>
<pre><code>TLS_&lt;1&gt;_WITH_&lt;2&gt;_&lt;3&gt;_&lt;4&gt;
</code></pre>
<p>where</p>
<ul>
<li><code>&lt;1&gt;</code> — Key exchange algorithm eg. <code>RSA</code>, <code>DHE</code>, <code>ECDHE</code></li>
<li><code>&lt;2&gt;</code> — Authentication algorithm eg. <code>RSA</code>, <code>ECDSA</code></li>
<li><code>&lt;3&gt;</code> — Encryption eg. <code>AES_128_GCM</code></li>
<li><code>&lt;4&gt;</code> — MAC algorithm eg. <code>SHA256</code></li>
</ul>
<p>eg.</p>
<pre><code>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
</code></pre>
<p>TLS 1.3 uses the following format (specifying only the symmetric cipher and hash function):</p>
<pre><code>TLS_&lt;3&gt;_&lt;4&gt;
</code></pre>
<p>eg.</p>
<pre><code>TLS_AES_128_GCM_SHA256
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ssl-proxying"><a class="header" href="#ssl-proxying">SSL proxying</a></h1>
<p>SSL proxying is a mechanism that allows a proxy server to intercept and decrypt TLS traffic, then re-encrypting the data to forward it to the intended recipient.</p>
<p>In SSL proxying, there are <strong>3 components</strong>:</p>
<ul>
<li>client</li>
<li>SSL proxy</li>
<li>remote server</li>
</ul>
<p>and <strong>2 SSL certificates</strong>:</p>
<ul>
<li>SSL proxy's certificate</li>
<li>remote server's certificate</li>
</ul>
<p>The client will be presented with the SSL proxy's certificate, so it must be installed and trusted on the client machine.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ssl-pinning"><a class="header" href="#ssl-pinning">SSL pinning</a></h1>
<p>aka certificate pinning</p>
<p>SSL pinning works by preloading the server's certificate in tbe client's application. </p>
<p>This is a security measure to prevent MITM attacks by associating a host with its expected SSL certificate.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ssh-1"><a class="header" href="#ssh-1">SSH</a></h1>
<p>SSH typically operates on top of TCP.</p>
<p>Here, SSH is used for client authentication and establishing a secure connection.</p>
<div id="admonition-using-ssh-with-github" class="admonition example">
<div class="admonition-title">
<p>Using SSH with GitHub</p>
<p><a class="admonition-anchor-link" href="osi-layer-6/ssh/index.html#admonition-using-ssh-with-github"></a></p>
</div>
<div>
<p>When you clone a repository from GitHub using SSH, you're using the SSH protocol to authenticate and establish a secure connection (instead of accessing a remote shell).</p>
<p>The communication between your computer and GitHub is encrypted, ensuring that your data is transferred securely.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup"><a class="header" href="#setup">Setup</a></h1>
<p>For this protocol to work, <strong>3 asymmetric key pairs</strong> are at play:</p>
<h2 id="1-servers-host-key-pair-permanent"><a class="header" href="#1-servers-host-key-pair-permanent">1. Server's host key pair (permanent)</a></h2>
<p>The private key, held by the server, is used to identify the server, typically stored in <code>/etc/ssh</code>.</p>
<p>These keys should be automatically created when installing SSH on the server (?), so no generation is required.</p>
<div id="admonition-_n_-pairs-of-server-host-keys" class="admonition note">
<div class="admonition-title">
<p><em>n</em> pairs of server host keys</p>
<p><a class="admonition-anchor-link" href="osi-layer-6/ssh/setup.html#admonition-_n_-pairs-of-server-host-keys"></a></p>
</div>
<div>
<p>There are <em>n</em> pairs of server host keys, where <em>n</em> is the no. of asymmetric cryptography used.</p>
<p>This can be RSA, ECDSA, ED25519 etc.</p>
</div>
</div>
<p>The public key is shared with the client <em>during the initial connection</em>. The client then stores this key typically in <code>~/.ssh/known_hosts</code>.</p>
<div id="admonition-trust-on-first-use" class="admonition warning">
<div class="admonition-title">
<p>Trust On First Use</p>
<p><a class="admonition-anchor-link" href="osi-layer-6/ssh/setup.html#admonition-trust-on-first-use"></a></p>
</div>
<div>
<p>The server should ideally share this public key with the clients <em>out-of-band</em> prior to any SSH connections.</p>
<p>Otherwise, the client is left to blindly trust the server on first connection.</p>
</div>
</div>
<h2 id="2-clients-key-pair-permanent"><a class="header" href="#2-clients-key-pair-permanent">2. Client's key pair (permanent)</a></h2>
<p>The private key, held by the client, is used for authenticating with the server.</p>
<p>The public key, should be shared with the server out-of-band prior to any SSH connection. This is typically stored in <code>~/.ssh/authorized_keys</code> at the server.</p>
<h2 id="3-ephemeral-key-pair"><a class="header" href="#3-ephemeral-key-pair">3. Ephemeral key pair</a></h2>
<p>The client and the server <em>each</em> will have to generate a key pair for every SSH session.</p>
<p>They are used to establish the session's shared secret using a key exchange algorithm.</p>
<hr />
<p>User configurations are typically stored at <code>~/.ssh/config</code>:</p>
<pre><code class="language-config">Host examplehostname
    HostName example.com
    IdentityFile ~/.ssh/example_private_key
    User raimi
    Port 11566
</code></pre>
<p>System configurations are typically stored at <code>/etc/ssh/ssh_config</code>.</p>
<p>More information can be found in</p>
<pre><code>man ssh_config
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="workflow"><a class="header" href="#workflow">Workflow</a></h1>
<p>After TCP handshake, this is what happens:</p>
<ol>
<li>
<p><strong>Server sends its public host key (initial connection only)</strong></p>
<p>If the client has never connected to this server before, it uses the &quot;trust on first use&quot; model and asks the user to confirm the server's key fingerprint. If the client has connected to this server before, it checks the server's public key against the one it has saved from previous connections.</p>
</li>
<li>
<p><strong>Set up session key (shared secret)</strong></p>
<p>A key exchange algorithm is used to set up a shared secret. The server creates a key pair and sends the client the public key (in this session itself). See key exchange algorithm for more.</p>
<p>Both the client and the server will then have the same shared secret.</p>
<p>This secret will be used as a key for <em>symmetric encryption</em> for the remainder of the session to encrypt the communication.</p>
</li>
<li>
<p><strong>Client authentication</strong></p>
<p>This makes use of the key pair that was previously set up out-of-band.</p>
<p>In this authentication, the client must prove that it can decrypt the message that the server encrypted.</p>
<ol>
<li>The server uses the public key to encrypt some message.</li>
<li>The client calculates a hash which is a function of the decrypted message and other metadata, then sends to server.</li>
<li>Server compares with its own calculation of hash (which should be the same).</li>
</ol>
</li>
</ol>
<div id="admonition-other-client-authentication-methods" class="admonition note">
<div class="admonition-title">
<p>Other client authentication methods</p>
<p><a class="admonition-anchor-link" href="osi-layer-6/ssh/workflow.html#admonition-other-client-authentication-methods"></a></p>
</div>
<div>
<p>Apart from asymmetric key pair, other authentication methods include:</p>
<ul>
<li>Password — the password is encrypted using the shared secret key</li>
<li>SSH certificates</li>
</ul>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="layer-4---transport"><a class="header" href="#layer-4---transport">Layer 4 - Transport</a></h1>
<p>What problems are we trying to solve?</p>
<ul>
<li>Network is unreliable due to <strong>congestion</strong> — when more packets than the network has bandwidth for are sent through, some packets get dropped (&quot;<strong>lost packets</strong>&quot;) and some get delayed (&quot;<strong>out-of-order</strong>&quot;).</li>
<li>Not all packets go through the same route. Some packets might arrive earlier (&quot;out-of-order&quot;).</li>
<li>Packets might get altered along the way (&quot;<strong>corrupted data</strong>&quot;)</li>
</ul>
<div id="admonition-definition-bandwidth" class="admonition info">
<div class="admonition-title">
<p>Definition: Bandwidth</p>
<p><a class="admonition-anchor-link" href="osi-layer-4/transport-layer.html#admonition-definition-bandwidth"></a></p>
</div>
<div>
<p>Rate at which the network can transport bits</p>
</div>
</div>
<p>Therefore, the goals of Layer 4 (not guaranteed by all protocols) are:</p>
<ul>
<li>
<p><strong>Provide reliable delivery</strong> of packets</p>
<ul>
<li>No lost packets</li>
<li>In-order delivery</li>
<li>No corrupted data</li>
</ul>
</li>
<li>
<p><strong>Control rate of data transmission</strong> to prevent congestion</p>
</li>
<li>
<p><strong>Multiplexing and demultiplexing</strong></p>
<p>Transport layer labels packets with the port number of the application a message is from and the one it is addressed to. This allows the layer to multiplex and demultiplex the data. TCP and UDP implement these differently.</p>
<p><img src="osi-layer-4/./tcp1.png" alt="TCP" /></p>
</li>
</ul>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<div class="table-wrapper"><table><thead><tr><th></th><th>QUIC</th><th>TCP</th><th>UDP</th></tr></thead><tbody>
<tr><td>Stateful connection</td><td>Connection ID</td><td>(IP address, port)</td><td>Connectionless</td></tr>
<tr><td>RTT</td><td>0</td><td>1</td><td>0</td></tr>
<tr><td>With TLS?</td><td>✅</td><td>❌</td><td>❌</td></tr>
<tr><td>Loss recovery mechanism</td><td>✅</td><td>✅</td><td>❌</td></tr>
<tr><td>Corrupted data mechanism</td><td>✅; No retransmit</td><td>✅; Retransmit</td><td>❌</td></tr>
<tr><td>Data integrity check</td><td>✅</td><td>✅</td><td>✅</td></tr>
</tbody></table>
</div><div id="admonition-definition-rtt" class="admonition info">
<div class="admonition-title">
<p>Definition: RTT</p>
<p><a class="admonition-anchor-link" href="osi-layer-4/transport-layer.html#admonition-definition-rtt"></a></p>
</div>
<div>
<p>Round-trip time</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tcp"><a class="header" href="#tcp">TCP</a></h1>
<p>Transport Control Protocol</p>
<p>TCP is a connection-oriented protocol. It is full-duplex (both hosts on a TCP connection can send messages to each other simultaneously).</p>
<h2 id="reliable-delivery"><a class="header" href="#reliable-delivery">Reliable delivery</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Goal</th><th>Solution</th></tr></thead><tbody>
<tr><td>In-order delivery</td><td>Use sequence numbers</td></tr>
<tr><td>No corrupted packets</td><td>Use checksum. Discard if invalid.</td></tr>
<tr><td>No lost packets segments</td><td>Use retransmission timer.^</td></tr>
</tbody></table>
</div>
<p>^TCP sends an acknowledgement for almost every segment</p>
<p><img src="osi-layer-4/./layer-4-2.png" alt="TCP" /></p>
<h2 id="congestion-control"><a class="header" href="#congestion-control">Congestion control</a></h2>
<ul>
<li><strong>Bandwidth allocation</strong> — Bandwidth is allocated per connection. A host can open multiple connections. Bandwidth cannot be divided and allocated equally among end-systems because real traffic is transmitted in bursts and not in one continuous stream.</li>
<li><strong>Fairness</strong> — Increasing the transmission rate. Of one end-system necessarily decreases another.</li>
<li><strong>Convergence</strong> — Bandwidth should be allocated such that no one host hogs all of it.
Congestion fixes:</li>
</ul>
<p>Congestion fixes:</p>
<ul>
<li>Send packets at a slower rate in response to congestion</li>
<li>Track changes in traffic</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="3-way-handshake"><a class="header" href="#3-way-handshake">3-way handshake</a></h1>
<pre class="mermaid">sequenceDiagram
    client -&gt;&gt; server: SYN, SequenceNum = x, Acknowledgement = -
    server -&gt;&gt; client: SYN+ACK, SequenceNum = y, Acknowledgement = x+1
    client -&gt;&gt; server: ACK, SequenceNum = -, Acknowledgement = y+1
</pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="message-format-1"><a class="header" href="#message-format-1">Message format</a></h1>
<p>A <strong>TCP packet</strong> consists of:</p>
<ul>
<li>Ethernet or wifi header</li>
<li>IP header</li>
<li>TCP header
<ul>
<li>Source port number</li>
<li>Destination port number</li>
<li>Sequence number</li>
<li>Acknowledgement number</li>
<li>Header length</li>
<li>…</li>
<li>Flag (synchronise, finish, push, reset, acknowledge, urgent)</li>
<li>Window size</li>
<li>Checksum</li>
<li>Urgent pointer</li>
<li>…</li>
</ul>
</li>
<li>Data (payload)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inspect"><a class="header" href="#inspect">Inspect</a></h1>
<p>Capture packets</p>
<pre><code class="language-sh">tcpdump [tcp|udp]  # socket type
    -i [en0|lo0]   # network interface
    -X             # print hex and ASCII
    host           # hostname
    port 3000      # port number (of destination?)
    -c 10          # capture 10 packets
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="udp"><a class="header" href="#udp">UDP</a></h1>
<p>User Datagram Protocol</p>
<p>UDP is a connectionless protocol.</p>
<p><strong>How it works</strong></p>
<ul>
<li>UDP does not involve any initial handshaking.</li>
<li>Message may not get delivered.</li>
<li>Message may have some changes.</li>
<li>Message may be delivered in the wrong order.</li>
<li>Checks for corrupted message but does not correct them.</li>
</ul>
<p><strong>Multiplexing and demultiplexing</strong></p>
<p><strong>UDP message</strong></p>
<p>Consists of:</p>
<ul>
<li>Source port number</li>
<li>Destination port number</li>
<li>Length of datagram (max 2^16)</li>
<li>Checksum</li>
<li>Data</li>
</ul>
<div id="admonition-who-uses-udp" class="admonition question">
<div class="admonition-title">
<p>Who uses UDP?</p>
<p><a class="admonition-anchor-link" href="osi-layer-4/udp.html#admonition-who-uses-udp"></a></p>
</div>
<div>
<ul>
<li>Xbox Live</li>
<li>Network management</li>
<li>Live audio/video streaming</li>
</ul>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quic"><a class="header" href="#quic">QUIC</a></h1>
<p>Quick UDP Internet Connections</p>
<p>QUIC includes TLS encryption by default.</p>
<div id="admonition-who-uses-quic" class="admonition info">
<div class="admonition-title">
<p>Who uses QUIC?</p>
<p><a class="admonition-anchor-link" href="osi-layer-4/quic.html#admonition-who-uses-quic"></a></p>
</div>
<div>
<p>iCloud Private Relay uses QUIC</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ssh-tunnel"><a class="header" href="#ssh-tunnel">SSH tunnel</a></h1>
<p>aka SSH port forwarding</p>
<ol>
<li>
<p><strong>Creating a tunnel</strong></p>
<p>SSH client establishes an SSH connection with an SSH server. This is generally made over port 22.</p>
</li>
<li>
<p><strong>Port forwarding</strong></p>
<p>The SSH tunnel is used to forward connections from a specified local (TCP) port to a specified remote (TCP) port (or vice versa).</p>
<p>There are two types of port forwarding:</p>
<ul>
<li>Local</li>
<li>Remote</li>
</ul>
<p><img src="osi-layer-4/ssh/./ssh-tunnel-1.png" alt="SSH tunnel" /></p>
</li>
</ol>
<p>https://robotmoon.com/ssh-tunnels/</p>
<div id="admonition-use-cases" class="admonition example">
<div class="admonition-title">
<p>Use cases</p>
<p><a class="admonition-anchor-link" href="osi-layer-4/ssh/ssh-tunnel.html#admonition-use-cases"></a></p>
</div>
<div>
<p>If direct access to an application is blocked by a firewall.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="layer-3---network-internet"><a class="header" href="#layer-3---network-internet">Layer 3 - Network (Internet)</a></h1>
<p>IP: “You're not supposed to be here!”</p>
<p>Responsibilities:</p>
<ul>
<li>Host addressing</li>
<li>Message forwarding: Since many networks are partitioned into subnetworks and connect to other networks for wide-area communications, networks use specialised hosts, called gateways or routers, to forward packets between networks.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ip"><a class="header" href="#ip">IP</a></h1>
<p>Internet Protocol</p>
<p>Provides an addressing system that allows devices on the network to be identified.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="routing"><a class="header" href="#routing">Routing</a></h1>
<p>Messages are routed via the route table.</p>
<p>Routing protocols</p>
<ul>
<li>Static: manually compute routes</li>
<li>Dynamic</li>
</ul>
<h2 id="nat"><a class="header" href="#nat">NAT</a></h2>
<p>Network Address Translation</p>
<p>A NAT allows all of the hosts of a router share one or a few public IPv4 addresses (usually between private and public). This is to deal with shortage of IPv4 addresses. What it does is to modify the IP addresses in the IP header.</p>
<p><img src="osi-layer-3/ip/./ip3.png" alt="IP" /></p>
<p>Router is a device that connects two different IP networks.</p>
<p><img src="osi-layer-3/ip/./ip4.png" alt="IP" /></p>
<p><img src="osi-layer-3/ip/./ip5.png" alt="IP" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ip-packet"><a class="header" href="#ip-packet">IP packet</a></h1>
<p><strong>packets</strong></p>
<p>The unit of information in the network layer</p>
<p><strong>Datagram</strong></p>
<p>A basic transfer unit</p>
<ul>
<li>Header
<ul>
<li>Version</li>
<li>Length</li>
<li><strong>Source address</strong></li>
<li><strong>Destination address</strong></li>
<li>Protocol</li>
<li>Checksum</li>
<li>Flags</li>
<li>TTL</li>
</ul>
</li>
<li><strong>Payload</strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="host-addressing"><a class="header" href="#host-addressing">Host addressing</a></h1>
<p>An IP address is mapped to a <em>network interface</em> in the host.</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="osi-layer-3/ip/ip-addresses.html#admonition-note"></a></p>
</div>
<div>
<p>Hosts (computers) don’t have IP addresses. Network interfaces do.</p>
</div>
</div>
<p>32-bit numbers written as 4 octets (decimals), separated by <code>.</code> Eg. 1.2.3.4.</p>
<p>To identify each device in the world-wide web, Internet Assigned Numbers Authority (IANA) assigns IPV4 address as a unique identifier for each device on the Internet. Length of the IP address is 32 bits. Hence there are</p>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="osi-layer-3/ip/ip-addresses.html#admonition-tip"></a></p>
</div>
<div>
<p>In Linux, you can get your IP address with</p>
<pre><code>ipconfig getifaddr en0
</code></pre>
</div>
</div>
<h2 id="address-classes"><a class="header" href="#address-classes">Address classes</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Class</th><th>Length of subnet ID</th><th>Range</th><th>Default subnet mask</th><th>Remarks</th></tr></thead><tbody>
<tr><td>Class A</td><td>1 octet</td><td>0.0.0.0 to 127.255.255.255</td><td>255.0.0.0</td><td></td></tr>
<tr><td>Class B</td><td>2 octets</td><td>128.0.0.0 to 191.255.255.255</td><td>255.255.0.0</td><td></td></tr>
<tr><td>Class C</td><td>3 Octets</td><td>192.0.0.0 to 223.255.255.255</td><td>255.255.255.0</td><td></td></tr>
<tr><td>Class D</td><td></td><td></td><td></td><td>For multicast</td></tr>
<tr><td>Class E</td><td></td><td></td><td></td><td>Reserved</td></tr>
</tbody></table>
</div>
<h2 id="subnetting"><a class="header" href="#subnetting">Subnetting</a></h2>
<ul>
<li>Subnetting based on octets (deprecated).</li>
<li>Variable-length subnetting.</li>
</ul>
<div class="table-wrapper"><table><thead><tr><th>Subnet</th><th>No. of possible addresses</th><th>Lowest address</th><th>Highest address</th></tr></thead><tbody>
<tr><td>10.0.0.0/30</td><td>2^2</td><td>10.0.0.0</td><td>10.0.0.3</td></tr>
<tr><td>192.0.2.0/24</td><td>2^8</td><td>192.0.2.0</td><td>192.0.2.255</td></tr>
</tbody></table>
</div>
<h2 id="address-assignment-using-subnetting"><a class="header" href="#address-assignment-using-subnetting">Address assignment using subnetting</a></h2>
<ul>
<li>Subnet mask: host bits set to 0
eg. 203.128.22.0 and a host can be 203.128.22.7</li>
<li>Network address: host bits set to 0
eg. 203.128.22.0.</li>
<li>Broadcast address: host bits set to 255 (all binary 1’s)
eg. 203.128.22.255</li>
<li>Host address: host bits
eg. 203.128.22.18</li>
</ul>
<h2 id="special-addresses"><a class="header" href="#special-addresses">Special addresses</a></h2>
<p><strong>Self-identification</strong></p>
<p>0.0.0.0/8</p>
<p><strong>Loopback address</strong></p>
<p>127.0.0.1/8</p>
<p>Each IPv4 host has a loopback interface that is not attached to a data link layer. This allows processes running on a host to use TCP/IP to contact other processes running on the same host. This is very useful for testing purposes.</p>
<p><strong>Private addresses</strong></p>
<p>10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16</p>
<p>Private networks that are not directly attached to the Internet.</p>
<p><strong>Link-local address</strong></p>
<p>169.254.0.0/16</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fragmentation-and-reassembly"><a class="header" href="#fragmentation-and-reassembly">Fragmentation and reassembly</a></h1>
<p>IPv4 packets need to be fragmented depending on the data link layer’s maximum transmission capability. They can be as big as 64KB.</p>
<p><img src="osi-layer-3/ip/./ip2.png" alt="IP" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="icmp"><a class="header" href="#icmp">ICMP</a></h1>
<p>Internet Control Message Protocol</p>
<p>For diagnostics</p>
<ul>
<li>Used by
<ul>
<li>ping</li>
<li>traceroute</li>
</ul>
</li>
</ul>
<p><strong>Messages</strong></p>
<ul>
<li>Destination unreachable
<ul>
<li>Network unreachable</li>
<li>Host unreachable</li>
<li>Protocol unreachable</li>
<li>Port unreachable</li>
</ul>
</li>
<li>Fragmentation needed</li>
<li>Redirect</li>
<li>Time exceeded</li>
<li>Echo request and echo reply</li>
<li>…</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="layer-12---physicaldatalink"><a class="header" href="#layer-12---physicaldatalink">Layer 1/2 - Physical/Datalink</a></h1>
<p><strong>Responsibilities</strong></p>
<p>Receive packet from network layer and deals with providing hop-to-hop communication between entities directly connected by a physical link.</p>
<ul>
<li>MAC layer
Responsible for controlling how devices in a network gain access to a medium and permission to transmit data</li>
<li>Logical link control layer</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="arp"><a class="header" href="#arp">ARP</a></h1>
<p>Address Resolution Protocol</p>
<p>ARP maps an end host's IP address to a MAC address.</p>
<p>Hosts maintain a table of these mappings, called an <strong>ARP cache</strong>.</p>
<div class="table-wrapper"><table><thead><tr><th>MAC address</th><th>IP address</th></tr></thead><tbody>
<tr><td>5f:44:11</td><td>192.20.1.1</td></tr>
</tbody></table>
</div>
<p>If the host doesn't know a MAC address for a certain IP address, it sends out an <strong>ARP request packet</strong>, asking other machines for the matching MAC address. The result is then updated in the host's ARP cache.</p>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="osi-layer-1/arp.html#admonition-tip"></a></p>
</div>
<div>
<p>To see the ARP cache:</p>
<pre><code>arp -na
</code></pre>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="access-networks"><a class="header" href="#access-networks">Access networks</a></h1>
<p>Networks that physically connect end systems (laptop, mobile phones) to the first router.</p>
<ul>
<li>Physical
<ul>
<li>DSL modem (Digital Subscriber Line)
<ul>
<li>Using telephony infrastructure thru telephone wires</li>
</ul>
</li>
<li>Dial-up
<ul>
<li>Using telephony infrastructure thru telephone wires</li>
</ul>
</li>
<li>Cable internet
<ul>
<li>Using cable TV infrastructure thru coaxial cable</li>
</ul>
</li>
<li>FTTH (Fiber to the home)
<ul>
<li>Using optic fibres</li>
</ul>
</li>
</ul>
</li>
<li>Remote
<ul>
<li>Satellite</li>
<li>WiFi</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="router"><a class="header" href="#router">Router</a></h1>
<p>A network device that can (i) bridge between different networks together, (ii) assign IP addresses using a protocol called DHCP, and (iii) determine what traffic can pass between them (most routers have a built-in Firewall).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="standards"><a class="header" href="#standards">Standards</a></h1>
<ul>
<li>MIME type</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="type-a-url-on-the-browser"><a class="header" href="#type-a-url-on-the-browser">Type a URL on the browser</a></h1>
<p>https://twitter.com/manekinekko/status/1281704000572858375</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h1>
<h2 id="quicks"><a class="header" href="#quicks">Quicks</a></h2>
<p><code>netstat</code> see open ports</p>
<h2 id="transport-layer"><a class="header" href="#transport-layer">Transport layer</a></h2>
<pre><code>sudo lsof     list files and processes
    -i        list only network sockets
    -i:8080   at port 8080
    -t        show only process ID
    -P        show port
</code></pre>
<p><img src="./troubleshooting1.png" alt="" /></p>
<p><img src="./troubleshooting2.png" alt="" /></p>
<p><img src="./troubleshooting3.png" alt="" /></p>
<p>Capture packets that are to or from my computer</p>
<pre><code>sudo tcpdump -p

sudo tcpdump [...] [and|or] [...]
    [src|dest|tcp] port &lt;port-no&gt;
    host &lt;IP-addr&gt;
</code></pre>
<p>Make TCP connections: chat server</p>
<pre><code>{
    nc -l 3456
}
{
    nc localhost 3456
}
</code></pre>
<p>Make tcp connections: file server</p>
<pre><code>{
    nc -l 4444 &gt; myfile.txt
}
{
    echo &quot;hiiii&quot; &gt; thefile.txt
    nc localhost 4444 &lt; thefile.txt
}
</code></pre>
<p>Netcat</p>
<pre><code>nc 
    en.wikipedia.org 80 other args 
    localhost 3456         client
    -l 3456                listen on port 3456
    -l 3456 | /bin/bash    listen on port 3456
    -z localhost 3456-3457 port scanning from 3456 to 3457
    -lU /var/tmp/dsocket   create a listening stream socket
    -U /var/tmp/dsocket    connect to an existing stream socket
    -v verbose
</code></pre>
<h2 id="network-layer"><a class="header" href="#network-layer">Network layer</a></h2>
<p>ICMP: echo request &amp; reply</p>
<pre><code>ping 8.8.8.8 send and receive network traffic with this address (‘ping server’)
    -c3 send 3 packets then stop
</code></pre>
<p><img src="./troubleshooting4.png" alt="" /></p>
<p>(TTL=no.of hops before being discarded)</p>
<p>Sending ICMP messages</p>
<pre><code>traceroute [address]   list hops between host and other host
	-m max TTL
</code></pre>
<pre><code>nmap -sP 192.168.1.0/24
</code></pre>
<pre><code>netstat -pant | grep LISTEN
</code></pre>
<pre><code>curl https://ipvigilante.com/133.237.7.85 | jq
</code></pre>
<pre><code>nc google.com 80
</code></pre>
<p>See what steps your packet takes to get somewhere</p>
<pre><code>traceroute google.com
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
