<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>os-book</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./theme/catppuccin.css">
        <link rel="stylesheet" href="./theme/catppuccin-highlight.css">
        <link rel="stylesheet" href="./mdbook-admonish.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Virtualisation</li><li class="chapter-item expanded "><a href="io.html"><strong aria-hidden="true">1.</strong> I/O</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Process abstraction</div></li><li class="chapter-item expanded "><a href="process_memory.html"><strong aria-hidden="true">3.</strong> Process memory</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Process scheduling</div></li><li class="chapter-item expanded "><a href="threads.html"><strong aria-hidden="true">5.</strong> Threads</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Inter-process communication</div></li><li class="chapter-item expanded "><a href="memory_management.html"><strong aria-hidden="true">7.</strong> Memory management</a></li><li class="chapter-item expanded "><a href="system_calls.html"><strong aria-hidden="true">8.</strong> System calls</a></li><li class="chapter-item expanded "><a href="vectorisation.html"><strong aria-hidden="true">9.</strong> Vectorisation</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Concurrency</li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> Synchronisation</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Persistence</li><li class="chapter-item expanded "><a href="file_system_management.html"><strong aria-hidden="true">11.</strong> File system management</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.</strong> Disk scheduling</div></li><li class="chapter-item expanded "><a href="shell.html"><strong aria-hidden="true">13.</strong> Shell</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frapp√©</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">os-book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="io"><a class="header" href="#io">I/O</a></h1>
<p>There is a buffer for output so the actual writing of file may not happen untill we close the file</p>
<h1 id="file-io"><a class="header" href="#file-io">File I/O</a></h1>
<p>What happens when you <code>read()</code> a file?</p>
<ol>
<li>Transfer control to the kernel using system call</li>
<li>Interact with the physical disk where the file resides</li>
<li>Copy the data into different buffers between user space and kernel space</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="process-memory"><a class="header" href="#process-memory">Process memory</a></h1>
<h2 id="windows-os"><a class="header" href="#windows-os">Windows OS</a></h2>
<p><strong>## Windows OS</strong></p>
<ul>
<li>
<p>PE file format - format for all executables</p>
</li>
<li>
<p>Header</p>
</li>
<li>
<p>Import</p>
</li>
<li>
<p>Export</p>
</li>
<li>
<p>Timestamp</p>
</li>
<li>
<p>Sections</p>
</li>
<li>
<p><code>.text</code></p>
</li>
<li>
<p><code>.rdata</code></p>
</li>
<li>
<p><code>.data</code></p>
</li>
<li>
<p><code>.rsrc</code></p>
</li>
</ul>
<h2 id="data-representation"><a class="header" href="#data-representation">Data representation</a></h2>
<ul>
<li>Intel CPUs: least significant address (&quot;endian&quot;) is put a lower address (&quot;little&quot;). This is called <strong>little endian</strong>.</li>
</ul>
<p>For example, the data <code>0x4f9c3d</code> is represented as such:</p>
<pre><code class="language-txt">address data

   0x11
   0x10
   0x09
   0x08 4f
   0x07 9c
   0x06 3d
   0x05
   0x04
   0x03
   0x02
   0x01
</code></pre>
<h2 id="process-memory-layout"><a class="header" href="#process-memory-layout">Process memory layout</a></h2>
<ul>
<li>text</li>
<li>initialised data</li>
<li>uninitialised data</li>
<li>stack
<ul>
<li>
<p>a stack frame is added whenever a function is called</p>
</li>
<li>
<p>in intel systems, stack grows <em>downwards</em> (high address to low address)</p>
</li>
<li>
<p>a stack frame (notice it goes upwards)</p>
</li>
</ul>
</li>
<li>heap</li>
</ul>
<p><a href="https://en.wikipedia.org/wiki/Von_Neumann_architecture">von Neumann architecture</a>.</p>
<pre><code>Address 

                                         0xdec3
                                         0xdec2
                                         0xdec1
                                         0xdec0 &lt;- rbp (0?) 
            3c) ret;                     0xdebf         
         move up thru                    0xdebe         
                                         ..            function parameters
                                         0xdeb2
                                         0xdeb1
                                         0xdeb0 &lt;- rsp (1?) (initial rsp); where the stack pointer points at initially
                                         0xdeaf // return address
                                         0xdeae // return address
                                         0xdead // return address
                  (3c) ret;              0xdeac // return address
       return to this address            0xdeab // return address
                                         0xdeaa // return address
                                         0xdea0 // return address
                                         0xdea9 // return address
$rsp moved up 8 bytes because value
  of the previous base pointer is 
  goes back into the RBP register
                    pop rbp; (3b) rsp -&gt; 0xdea8 &lt;- rsp (1c) (call); $rsp moved down 8 bytes because a return address (8 bytes) is pushed
                                         0xdea7 // prev. base pointer aka prev frame
                                         0xdea6 // prev. base pointer aka prev frame
                                         0xdea5 // prev. base pointer aka prev frame
                                         0xdea4 // prev. base pointer aka prev frame
                                         0xdea3 // prev. base pointer aka prev frame
                                         0xdea2 // prev. base pointer aka prev frame
                                         0xdea1 // prev. base pointer aka prev frame
**$rsp moved up through 
            local variables; (3a) rsp** -&gt; 0xdea0 &lt;- rsp (2a) push rbp; $rsp moved down 8 bytes because value of RBP is pushed.
                                                &lt;- rbp (2b) mov rbp,rsp; set $rbp's value to the value of $rsp
                                                ******** new base pointer ********
                                         0xde99 // local variables
                                         0xde98 // local variables
                                         0xde97 // local variables
                                         0xde96 // local variables
                                         0xde95 // local variables
                                         0xde94 // local variables
                                         0xde93 // local variables
                                         0xde92 // local variables
                                         0xde91 // local variables
                                         0xde90 &lt;- rsp (2c) sub rsp,0x10; $rsp moved down to make space for local variables
                                                ******** new stack pointer ********
</code></pre>
<p>EAX used in multiplication and division
‚Ä¢ EBP and ESP are used for tracking the stack
‚Ä¢ EAX is used to store the return value for call
‚Ä¢ ECX is used as a counting variable
‚Ä¢ ESI and EDI are used for copying data in loops
‚Ä¢ (Source and Destination)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="threads"><a class="header" href="#threads">Threads</a></h1>
<ul>
<li>Useful for IO tasks</li>
<li>Two threads cannot execute code simultaneously</li>
<li>Sharing info between threads is faster as they share the same memory space</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="memory-management"><a class="header" href="#memory-management">Memory management</a></h1>
<p><strong>Dynamic memory allocation</strong></p>
<p>allocate and deallocate objects</p>
<p><strong>Garbage collection</strong></p>
<p>mutator and collector</p>
<ul>
<li>Mark-sweep collection</li>
<li>Mark compact collection</li>
<li>Copying collection</li>
<li>Reference counting</li>
</ul>
<p>Demand paging</p>
<p><a href="https://stackoverflow.com/questions/8506865/when-a-binary-file-runs-does-it-copy-its-entire-binary-data-into-memory-at-once">When a binary file runs, does it copy its entire binary data into memory at once?</a></p>
<p>Page fault and memory swap</p>
<p><a href="https://scoutapm.com/blog/understanding-page-faults-and-memory-swap-in-outs-when-should-you-worry">Understanding page faults and memory swap-in/outs: when should you worry?</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="system-calls"><a class="header" href="#system-calls">System calls</a></h1>
<p><code>man -k .</code>  Get system calls</p>
<p><strong>File descriptors and opening files</strong></p>
<pre><code class="language-c">#include &lt;fcntl.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;

int fd1, fd2;

fd1 = open(&quot;hello.txt&quot;, O_RDONLY);
if (fd1 &lt; 0) {
perror(&quot;c1&quot;);
exit(1);
  }

fd2 = open(&quot;hello.txt&quot;, O_RDONLY);
if (fd2 &lt; 0) {
perror(&quot;c1&quot;);
exit(1);
  }
</code></pre>
<h1 id="files"><a class="header" href="#files">Files</a></h1>
<ul>
<li><code>open</code></li>
<li><code>read</code></li>
<li><code>write</code></li>
<li><code>execve</code></li>
</ul>
<h1 id="networking"><a class="header" href="#networking">Networking</a></h1>
<ul>
<li><code>connect</code></li>
<li><code>send</code></li>
<li><code>recv</code></li>
<li><code>sendto</code></li>
<li><code>recvfrom</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vectorisation"><a class="header" href="#vectorisation">Vectorisation</a></h1>
<p><a href="https://cvw.cac.cornell.edu/vector/default">https://cvw.cac.cornell.edu/vector/default</a></p>
<p><a href="https://www.reddit.com/r/rust/comments/8uccla/does_rustc_have_autovectorization/">https://www.reddit.com/r/rust/comments/8uccla/does_rustc_have_autovectorization/</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="file-system-management"><a class="header" href="#file-system-management">File system management</a></h1>
<p>iNodes data structure</p>
<p>Linux FHS (Filesystem Hierarchy Standard)</p>
<pre><code>‚îú‚îÄ‚îÄ bin  command binaries eg. ls, mv
‚îú‚îÄ‚îÄ sbin bin for superuser eg. shutdown, reboot
‚îú‚îÄ‚îÄ dev  device files (interface to devices)
‚îú‚îÄ‚îÄ etc  &quot;everything to configure&quot;; system-wide config files
‚îú‚îÄ‚îÄ home users‚Äô home directories
‚îú‚îÄ‚îÄ opt  optional application software packages eg. gradle
‚îú‚îÄ‚îÄ tmp  temporary files
‚îú‚îÄ‚îÄ lib  common libraries for system programs
‚îú‚îÄ‚îÄ var  variable files (system and application logs) 
 ¬†¬† ‚îî‚îÄ‚îÄ lib         State information. Persistent data modified by programs as they run (eg. databases)
‚îî‚îÄ‚îÄ usr read-only user data
 ¬†¬† ‚îú‚îÄ‚îÄ bin         system-installed binaries eg. gcc
 ¬†¬† ‚îú‚îÄ‚îÄ lib         system-installed libraries (static &amp; dynamic)
 ¬†¬† ‚îú‚îÄ‚îÄ libexec
 ¬†¬† ‚îú‚îÄ‚îÄ sbin
 ¬†¬† ‚îú‚îÄ‚îÄ share
 ¬†¬† ‚îú‚îÄ‚îÄ standalone
 ¬†¬† ‚îî‚îÄ‚îÄ local
        ‚îú‚îÄ‚îÄ Caskroom
        ‚îú‚îÄ‚îÄ Cellar
        ‚îú‚îÄ‚îÄ Frameworks
        ‚îú‚îÄ‚îÄ Homebrew
        ‚îú‚îÄ‚îÄ bin           user-installed binaries eg. rustc
        ‚îú‚îÄ‚îÄ etc
        ‚îú‚îÄ‚îÄ include       user-installed headers
        ‚îú‚îÄ‚îÄ lib           user-installed libraries (static &amp; dynamic)
        ‚îú‚îÄ‚îÄ man
        ‚îú‚îÄ‚îÄ opt
        ‚îú‚îÄ‚îÄ remotedesktop
        ‚îú‚îÄ‚îÄ share
        ‚îú‚îÄ‚îÄ texlive
        ‚îî‚îÄ‚îÄ var
</code></pre>
<p><code>/etc/hosts</code></p>
<p>map hostname to IP address</p>
<hr />
<p>a file is a stream of data</p>
<p>The OS provides 3 files that are always open to every running process:</p>
<ul>
<li>stdin (standard input)</li>
<li>stdout (standard output)</li>
<li>stderr (standard error)</li>
</ul>
<p>Another file that is open:</p>
<p>tele typewriter aka tty.</p>
<pre><code class="language-bash">$ tty
/dev/ttys001
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="shell"><a class="header" href="#shell">Shell</a></h1>
<p>Every terminal you open gets assigned a new file via <code>tty</code>.</p>
<p>tty is a file</p>
<p>Every time you write a command on the terminal, the shell creates a duplicate process (via <code>fork()</code>).</p>
<p><strong>Shell:</strong> a user interface to send commands to OS. ‚ÄúShell‚Äù because it is the outermost layer around the OS‚Äôs ‚Äúkernel.‚Äù</p>
<ul>
<li>CLI shells
<ul>
<li>Unix shells
<ul>
<li>Bourne Shell (sh)</li>
<li>Bourne-Again Shell (bash)</li>
<li>Z Shell (zsh)</li>
<li>Xonsh</li>
</ul>
</li>
<li>Windows shells
<ul>
<li>CMD</li>
<li>PowerShell</li>
<li>Windows subsystem for Linux (WSL)</li>
</ul>
</li>
</ul>
</li>
<li>GUI shells</li>
</ul>
<p><strong>Terminal emulator / terminal</strong>: a graphical application to access shell</p>
<ul>
<li>macOS terminals
<ul>
<li>Terminal</li>
<li>iTerm2</li>
<li>Hyper</li>
</ul>
</li>
<li>Windows terminals
<ul>
<li>Command Prompt</li>
<li>Cygwin</li>
<li>Windows Terminal</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
