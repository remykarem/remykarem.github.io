<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>crypto-book</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="preface.html"><strong aria-hidden="true">1.</strong> Preface</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="hash_functions.html"><strong aria-hidden="true">2.</strong> Hash functions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="md5.html"><strong aria-hidden="true">2.1.</strong> MD5</a></li><li class="chapter-item expanded "><a href="sha.html"><strong aria-hidden="true">2.2.</strong> SHA</a></li></ol></li><li class="chapter-item expanded "><a href="keyed_hash_functions.html"><strong aria-hidden="true">3.</strong> Keyed hash functions</a></li><li class="chapter-item expanded "><a href="kdf.html"><strong aria-hidden="true">4.</strong> Key derivation functions</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Random number generator functions</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Key generator</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> Random</div></li><li class="chapter-item expanded "><a href="rsa.html"><strong aria-hidden="true">6.2.</strong> RSA</a></li><li class="chapter-item expanded "><a href="ecdsa.html"><strong aria-hidden="true">6.3.</strong> ECDSA</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Encyption</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="aes.html"><strong aria-hidden="true">7.1.</strong> AES</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.1.1.</strong> Basic</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.1.2.</strong> AEAD</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.2.</strong> RSA</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.3.</strong> ECDSA</div></li></ol></li><li class="chapter-item expanded "><a href="key_exchange.html"><strong aria-hidden="true">8.</strong> Key agreement</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">8.1.</strong> ECDH</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> Hybrid</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">9.1.</strong> PGP</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.2.</strong> GPG</div></li></ol></li><li class="chapter-item expanded "><a href="padding.html"><strong aria-hidden="true">10.</strong> Padding</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="formats.html"><strong aria-hidden="true">11.</strong> Formats</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Applications</li><li class="chapter-item expanded "><a href="keys.html"><strong aria-hidden="true">12.</strong> Keys</a></li><li class="chapter-item expanded "><a href="checksum.html"><strong aria-hidden="true">13.</strong> Checksum</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">14.</strong> MAC</div></li><li class="chapter-item expanded "><a href="digital_signature.html"><strong aria-hidden="true">15.</strong> Digital signature</a></li><li class="chapter-item expanded "><a href="ciphertext.html"><strong aria-hidden="true">16.</strong> Ciphertext</a></li><li class="chapter-item expanded "><a href="digital_certificate.html"><strong aria-hidden="true">17.</strong> Digital certificate</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">18.</strong> Derived keys</div></li><li class="chapter-item expanded "><a href="ssh.html"><strong aria-hidden="true">19.</strong> SSH</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="utils.html"><strong aria-hidden="true">20.</strong> Utils</a></li><li class="chapter-item expanded "><a href="code.html"><strong aria-hidden="true">21.</strong> Code</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">crypto-book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="preface"><a class="header" href="#preface">Preface</a></h1>
<p><a href="https://cryptobook.nakov.com/">https://cryptobook.nakov.com</a></p>
<p><a href="https://connect2id.com/products/nimbus-jose-jwt/examples">https://connect2id.com/products/nimbus-jose-jwt/examples</a></p>
<p>https://developers.google.com/tink/deterministic-encryption</p>
<h1 id="goals"><a class="header" href="#goals">Goals</a></h1>
<p>&quot;item&quot; = document, message, password</p>
<p>Integrity — proof that the item is not altered</p>
<p>Authenticity/authentication — proof that the item comes from a known source</p>
<p>Confidentiality/Privacy/secrecy — no one can read (and understand) the message in the item</p>
<p>Symmetry — if there is content encryption, is the same key used for both encryption and decryption?</p>
<p>Randomisation - if there is content encryption, will the same plaintext yield different ciphertexts?</p>
<p>Non-repudiation — the signer cannot deny that they signed (because...?)</p>
<p>Resistant to attacks — the item cannot be easily guessed</p>
<p><a href="https://en.wikipedia.org/wiki/Confusion_and_diffusion">https://en.wikipedia.org/wiki/Confusion_and_diffusion</a></p>
<div class="table-wrapper"><table><thead><tr><th>Ting</th><th>Confidentiality</th><th>Authenticity</th><th>Integrity</th><th>Symmetry</th><th>Output randomness</th></tr></thead><tbody>
<tr><td>MAC</td><td>❌</td><td>✅</td><td>✅</td><td>Symmetric</td><td>Either</td></tr>
<tr><td>Digital signature</td><td>❌</td><td>✅</td><td>✅</td><td>Asymmetric</td><td>?</td></tr>
<tr><td>Deterministic AEAD</td><td>✅</td><td>✅</td><td>-</td><td>Symmetric</td><td>Deterministic</td></tr>
<tr><td>AEAD ciphertext</td><td>✅</td><td>✅</td><td>-</td><td>Symmetric</td><td>Random</td></tr>
<tr><td>Basic AES ciphertext</td><td>✅</td><td>?</td><td>-</td><td>Symmetric</td><td>Random</td></tr>
<tr><td>Public-key ciphertext</td><td>✅</td><td>✅</td><td>-</td><td>Asymmetric</td><td>Random</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="hash-functions"><a class="header" href="#hash-functions">Hash functions</a></h1>
<p>aka &quot;hash function&quot;, &quot;hashing algorithm&quot;, &quot;message digest algorithm&quot;</p>
<pre><code>message -&gt; digest
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="md5"><a class="header" href="#md5">MD5</a></h1>
<p>Digest size: 128 bits (16 bytes)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sha"><a class="header" href="#sha">SHA</a></h1>
<div class="table-wrapper"><table><thead><tr><th>Hash function</th><th>Digest size</th><th>Names</th><th>Remarks</th></tr></thead><tbody>
<tr><td>SHA-1</td><td>160 bits</td><td>SHA-1</td><td>⚠️ broken</td></tr>
<tr><td>SHA-2 family</td><td>224/256/384/512 bits</td><td>SHA-224, SHA-256, SHA-384, SHA-512</td><td></td></tr>
<tr><td>SHA-3 family (&quot;Keccak&quot;)</td><td>224/256/384/512 bits</td><td>SHA3-224, SHA3-256, SHA3-384, SHA3-512</td><td></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="keyed-hash-functions"><a class="header" href="#keyed-hash-functions">Keyed hash functions</a></h1>
<p>A <strong>keyed hash function</strong> (aka MAC algorithm) is a hash function that takes in a key and a message to produce a digest called <strong>message authentication code</strong> (MAC). </p>
<pre><code>(message, key) -&gt; mac
</code></pre>
<p>There are different types of MAC algorithms:</p>
<ul>
<li>HMAC - hash-based MAC eg. HMAC-SHA256</li>
<li>CMAC- cipher-based MAC</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kdf"><a class="header" href="#kdf">KDF</a></h1>
<p>Key-derivation functions</p>
<pre><code>secret_value -&gt; key
</code></pre>
<p><a href="https://blog.boot.dev/cryptography/key-derivation-functions/">https://blog.boot.dev/cryptography/key-derivation-functions/</a></p>
<p>The algorithms use <em>key stretching</em> techniques that include:</p>
<ul>
<li>salt</li>
<li>many iterations</li>
</ul>
<pre><code class="language-tsx">derivationFunction(password, salt, difficulty) -&gt; key
</code></pre>
<p>Properties</p>
<ul>
<li>Key stretching</li>
<li>Key separation — create child keys from a master key</li>
<li>Key strengthening</li>
<li>(Properties of hash)</li>
</ul>
<p>Types of KDF</p>
<ul>
<li>
<p>Hash-based (most common)</p>
<ul>
<li>
<p>Bcrypt</p>
<pre><code>$2a$07$wHirdrK4OLB0vk9r3fiseeYjQaCZ0bIeKY9qLsNep/I2nZAXbOb7m
</code></pre>
</li>
<li>
<p>Scrypt</p>
<pre><code>16384$8$1$kytG1MHY1KU=$afc338d494dc89be40e317788e3cd9166d066709db0e6481f0801bd918710f46
</code></pre>
</li>
<li>
<p>Argon</p>
<pre><code>$argon2d$v=19$m=1024,t=16,p=4$c2FsdDEyM3NhbHQxMjM$2dVtFVPCezhvjtyu2PaeXOeBR+RUZ6SqhtD/+QF4F1o
</code></pre>
</li>
</ul>
</li>
<li>
<p>Block cipher-based</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rsa"><a class="header" href="#rsa">RSA</a></h1>
<p>Rivest-Shamir-Adleman; 1995</p>
<p>Keywords: modular exponentiation, prime factorisation, co-prime, greatest common divisor, prime numbers</p>
<p>RSA is an algorithm that generates public-private keys. You need to specify the length of the modulus \( n \): one of 1024, 2048, 3072, 4096, 8129, 16,384 bits. NIST recommends 2048 <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-57Pt3r1.pdf">here</a>.</p>
<p>For PKCS1 v1.5, the message to encrypt should be <strong>no longer than the public modulus minus 11 bytes</strong>. <a href="http://golang.org/pkg/crypto/rsa/#EncryptPKCS1v15">http://golang.org/pkg/crypto/rsa/#EncryptPKCS1v15</a>.</p>
<ul>
<li>secret exponent: \(d \)</li>
<li>key exponent: \(e \)</li>
<li>modulus: \( n \)</li>
<li>message: \(m \)</li>
<li>cipher: \(c \)</li>
</ul>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How it works</a></h2>
<p>A message \(m \) is encrypted by taking the modular exponentation \(e \) to get the cipher \(c \). </p>
<p>$$
c = m^e \bmod n
$$</p>
<p>The process is reversed using modular inverse (\(d \)).</p>
<p>$$
m = c^d \bmod n
$$</p>
<p>This means that \(e \) and \(d \) should be related like so:</p>
<p>$$
ed = 1 \bmod \phi(n)
$$</p>
<h2 id="generate-key-pair"><a class="header" href="#generate-key-pair">Generate key pair</a></h2>
<ol>
<li>
<p>Choose 2 <em>large prime numbers</em> such that their product is of the required bit length. For didactic purposes we use small numbers:</p>
<p>$$ p=3, q=11 $$</p>
</li>
<li>
<p>Compute \( n \) and \( \phi(n) \).</p>
<p>$$
n = pq = 33
$$</p>
<p>$$
\phi(n) = (p-1)(q-1)=20
$$</p>
<blockquote>
<p>💡 Note that to get back \( p \) and \( q \) from \( n \) is called prime factorisation and is a hard problem. If you solve it, you're in.</p>
</blockquote>
<blockquote>
<p>💡 \( \phi(n) \) is called <a href="https://en.wikipedia.org/wiki/Euler%27s_totient_function">Euler's totient function</a>. This function is chosen because it's hard to calculate without knowing \( p \) and \( q \).</p>
</blockquote>
<blockquote>
<p>💡 \( \phi(n) \) is the &quot;internal secret.&quot;</p>
</blockquote>
</li>
<li>
<p>Choose \(e \) to be used for modular exponentation such that:</p>
<ul>
<li>
<p>\(1 &lt; e &lt; \phi(n) \)</p>
<blockquote>
<p>💡 Why? SO post <a href="https://crypto.stackexchange.com/questions/87018/rsa-algorithm-must-e-be-less-than-varphin">here</a>.</p>
</blockquote>
</li>
<li>
<p>\( e \) and \( \phi(n) \) are co-prime. </p>
<blockquote>
<p>💡 If they are not co-prime, it becomes impossible to decrypt uniquely (see SO post <a href="https://crypto.stackexchange.com/questions/12255/in-rsa-why-is-it-important-to-choose-e-so-that-it-is-coprime-to-%CF%86n">here</a>).</p>
</blockquote>
</li>
</ul>
<p>If \( e \) and \( \phi(n) \) are not co-prime, then from Euler's theorem, \( e \) and \( n \) are not co-prime (?). If that is the case</p>
<p>For didactic purposes, we'll choose:</p>
<p>$$
e = 7
$$</p>
<blockquote>
<p>💡 In practice, this number is usually chosen to be 65,537, which is a prime number.</p>
</blockquote>
</li>
<li>
<p>To reverse the encryption, we need \( d \) to perform the inverse of modulo, such that \(ed \bmod \phi =1 \).</p>
<p>Solve \(d \) such that</p>
<ol>
<li>\(1 &lt; d &lt; \phi \)</li>
</ol>
</li>
</ol>
<p>Your <strong>public key</strong> is: (\(e \), \( n \))</p>
<p>Your <strong>private key</strong> is: (\(d \), \( n \))</p>
<h2 id="rsa-in-the-wild"><a class="header" href="#rsa-in-the-wild">RSA in the wild</a></h2>
<p>RSA is usually used with padding.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ecdsa"><a class="header" href="#ecdsa">ECDSA</a></h1>
<p>Elliptic-curve Digital Signature Algorithm</p>
<p>Keywords: Elliptic curve, Discrete logarithm problem</p>
<p>modern, smaller, faster, more efficient</p>
<p><a href="https://blog.boot.dev/cryptography/elliptic-curve-cryptography/">https://blog.boot.dev/cryptography/elliptic-curve-cryptography/</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="aes"><a class="header" href="#aes">AES</a></h1>
<p>A <em>deterministic</em> symmetric encryption algorithm operating on blocks</p>
<pre><code>(plaintext, key) -&gt; ciphertext

(ciphertext, key) -&gt; plaintext
</code></pre>
<hr />
<p>💡 A <strong>block</strong> is a fixed-length group of <em>bits</em></p>
<ul>
<li>AES (Advanced Encryption Standard)</li>
<li>DES (Data Encryption Standard)</li>
</ul>
<p>Block ciphers can operate in a <em>mode of operation</em>. This involves <em>repeated</em> XOR-ing a block etc. to achieve confidentiality and authentication. Involves some initial randomness (IV). Here are some:</p>
<ul>
<li>Confidentiality + Authentication
<ul>
<li>GCM</li>
<li>EAX</li>
</ul>
</li>
<li>Confidentiality
<ul>
<li>CBC — each block depends on the proper encryption block before it</li>
<li>ECB</li>
<li>CFB</li>
<li>CTR</li>
</ul>
</li>
</ul>
<hr />
<p>AES is a block cipher that operates on blocks of <strong>128 bits (16 bytes)</strong>. It breaks the plaintext into similar size blocks.</p>
<p>The shared keys can be of length 128, 192 or 256 bits.</p>
<p>An <strong>initialisation vector</strong> (IV) is used to ensure that the same plaintext will not always get encrypted to the same ciphertext. The IV is needed when decrypting the ciphertext.</p>
<p>A <strong>mode</strong> or <strong>encyrption mode</strong> is the algorithm used to encrypt data. It defines how you encrypt or re-encrypt every small block, etc.</p>
<ul>
<li>ECB</li>
<li>CBC</li>
<li>CFB</li>
<li>OFB</li>
<li>CTR</li>
</ul>
<pre><code class="language-txt">AES-128-CBC 
 ^   ^   ^
 |   |   |
alg key mode
  length
</code></pre>
<p>Finally, the ciphertext will include the initialisation vector and ciphertext.</p>
<p>Note that some modes allow partial decryption, like the CTR.</p>
<p>Resources:</p>
<ul>
<li><a href="https://medium.com/swlh/an-introduction-to-the-advanced-encryption-standard-aes-d7b72cc8de97">https://medium.com/swlh/an-introduction-to-the-advanced-encryption-standard-aes-d7b72cc8de97</a></li>
<li><a href="https://www.highgo.ca/2019/08/08/the-difference-in-five-modes-in-the-aes-encryption-algorithm/">https://www.highgo.ca/2019/08/08/the-difference-in-five-modes-in-the-aes-encryption-algorithm/</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="key-exchange"><a class="header" href="#key-exchange">Key exchange</a></h1>
<h1 id="key-agreement"><a class="header" href="#key-agreement">Key agreement</a></h1>
<p>Both parties contribute to the negotiation of the shared secret</p>
<h2 id="dhke-diffie-hellman"><a class="header" href="#dhke-diffie-hellman">DHKE (Diffie-Hellman)</a></h2>
<p><img src="diag.png" alt="Untitled" /></p>
<h2 id="ecdh-elliptic-curve-diffie-hellman"><a class="header" href="#ecdh-elliptic-curve-diffie-hellman">ECDH (Elliptic-curve Diffie-Hellman)</a></h2>
<h1 id="key-transport"><a class="header" href="#key-transport">Key transport</a></h1>
<p>Typically implemented through public-key</p>
<ul>
<li>
<p>Code</p>
<pre><pre class="playground"><code class="language-kotlin"><span class="boring">fun main() {
</span>note over alice: file.txt
alice-&gt;alice: create\n key pair
note over alice: pubkey\nptekey\n file.txt
note over bob: cert\n bob pubkey\n bob ptekey
bob--&gt;alice: i want to see ur secrets ;)
bob-&gt;alice: cert
alice-&gt;alice: extract\n pub key
note over alice: bob pubkey\n pubkey\nptekey\n file.txt
alice-&gt;alice: create\n symkey.pem\n with bob pubkey
note over alice: symkey.pem\n bob pubkey\n pubkey\nptekey\n file.txt
alice-&gt;alice: encrypt\n symkey.pem
note over alice: symkey.enc\n symkey.pem\n bob pubkey\n pubkey\nptekey\n file.txt
alice-&gt;alice: generate\n signature
note over alice: signature\n symkey.enc\n symkey.pem\n bob pubkey\n pubkey\nptekey\n file.txt
alice-&gt;bob: symkey.enc + signature
note over bob: symkey.enc\n bob pubkey\n bob ptekey
bob-&gt;bob: decrypt\n symkey.enc\n with ptekey
note over bob: symkey.pem\n symkey.enc\n bob pubkey\n bob ptekey
bob-&gt;bob: compare\n with signature 
bob--&gt;alice: alls good,\n let's use\n this key from now 
alice-&gt;alice: encrypt\n file.txt\n with symkey.pem
note over alice: file.enc\n signature\n symkey.enc\n symkey.pem\n bob pubkey\n pubkey\nptekey\n file.txt
alice-&gt;bob: file.enc
note over bob: file.enc\nsymkey.pem\n symkey.enc\n bob pubkey\n bob ptekey
bob-&gt;bob: decrypt\n file.enc\n with symkey.pem
note over bob: file.txt\n file.enc\nsymkey.pem\n symkey.enc\n bob pubkey\n bob ptekey
<span class="boring">}</span></code></pre></pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="padding"><a class="header" href="#padding">Padding</a></h1>
<p>Symmetric</p>
<p>Public key</p>
<ul>
<li>PKCS#1 v1.5</li>
<li>OAEP</li>
<li>PSS</li>
</ul>
<h2 id="padding-schemes"><a class="header" href="#padding-schemes">Padding schemes</a></h2>
<p>Add data in the beginning, middle or end of a message prior to encryption. This is to obscure the face that many messages end in predictable ways.</p>
<ul>
<li>OAEP</li>
<li>PKCS #5, #7, #8, ...</li>
<li>ANSI X9.23</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="formats--encoding"><a class="header" href="#formats--encoding">Formats / encoding</a></h1>
<p>File</p>
<ul>
<li>
<p>PEM format is base64; <code>.pem</code></p>
<p><strong>PEM — Privacy-Enhanced Mail</strong></p>
<p>format for storing and sending cryptographic keys. Base64</p>
<p><code>.pem</code>, <code>.key</code>, </p>
<pre><code>----BEGIN PRIVATE KEY----
MIIJRAIBADANBgkqhkiG9w0BAQEFAASCCS4wggkqAgEAAoICAQD2GlhF9HuoPwiF
S8lh0lHCwVGlVq0Jqtmp7ieyVOZ0mbU6T2KCDwkL3mWWSiVZc+cjh3EOsXtyzuiq
-----END PRIVATE KEY-----
</code></pre>
</li>
<li>
<p>Plaintext base64</p>
</li>
<li>
<p>DER format is binary. Commonly used in java</p>
</li>
</ul>
<p>Abstract</p>
<ul>
<li>ASN.1??</li>
</ul>
<p>Standards that define extra padding etc of private key</p>
<ul>
<li>PKCS#8; common format for RSA; req by java</li>
</ul>
<p>Standard format for public key certificates</p>
<ul>
<li>
<p>X.509</p>
<ul>
<li>public key</li>
<li>Signature</li>
<li>Other info
<ul>
<li>Country name</li>
<li>Website</li>
</ul>
</li>
</ul>
<p>Applications</p>
<ul>
<li>sSL</li>
<li>Document signing</li>
</ul>
<p>new cert (new private key etc.)</p>
<pre><code class="language-bash">openssl req -newkey rsa:2048 -nodes -keyout domain.key -x509 -days 365 -out domain.crt
</code></pre>
<p>new cert from existing private key</p>
</li>
</ul>
<hr />
<p>PEM is an encoding</p>
<p>PKCS* is a format/structured container</p>
<p>pkcs1</p>
<ul>
<li>MIIEo… MIIEp…</li>
<li>old format</li>
<li>openssl genrsa</li>
<li>openssl asn1parse -in key.pem
returns a seq of 9 integers</li>
</ul>
<p>pkcs8</p>
<ul>
<li>MIIEv…</li>
<li>modern format</li>
<li>openssl genpkey -algorithm rsa (-pkeyopt rsa_keygen_bits:2048)</li>
<li>openssl pkcs8 -topk8 -in private_key.pem -out private_key.p8 (-nocrypt)</li>
<li>openssl asn1parse -in key.pem</li>
</ul>
<p>pkcs8 pub</p>
<ul>
<li>MIIB…</li>
<li>modern format</li>
<li>openssl rsa -in file -pubout</li>
<li>openssl asn1parse -in key.pem</li>
</ul>
<p>csr</p>
<ul>
<li>openssl req -newkey rsa:2048 -nodes -keyout domain.key -out domain.csr</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="keys"><a class="header" href="#keys">Keys</a></h1>
<pre><code class="language-bash">openssl genpkey -out privatekey.pem -algorithm RSA -pkeyopt rsa_keygen_bits:2048
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="checksum"><a class="header" href="#checksum">Checksum</a></h1>
<p>The goal of checksum is to verify integrity.</p>
<p>It's common to check checksums when downloading files from websites.</p>
<ul>
<li>Anaconda uses <a href="md5.html">MD5</a> to compare checksums. <a href="https://anaconda.org/conda-forge/boto3/files">Here</a> is an example of the usage of checksum for boto3 package which is an AWS client (click on the (i) icon).</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="digital-signature"><a class="header" href="#digital-signature">Digital signature</a></h1>
<ul>
<li>ECDSA</li>
<li>Ed25519</li>
<li>RSA PKCS1-v1.5</li>
<li>RSA PSS</li>
<li>JWS</li>
<li>AWS Sigv4</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ciphertext"><a class="header" href="#ciphertext">Ciphertext</a></h1>
<p>Ciphertext offers confidentiality and authenticity.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="digital-certificate"><a class="header" href="#digital-certificate">Digital certificate</a></h1>
<p>CSR</p>
<p>openssl</p>
<p><a href="http://www.cs.toronto.edu/~arnold/427/19s/427_19S/tool/ssl/notes.pdf">http://www.cs.toronto.edu/~arnold/427/19s/427_19S/tool/ssl/notes.pdf</a></p>
<p><img src="csr.png" alt="Untitled" /></p>
<p><a href="https://superuser.com/questions/620121/what-is-the-difference-between-a-certificate-and-a-key-with-respect-to-ssl">https://superuser.com/questions/620121/what-is-the-difference-between-a-certificate-and-a-key-with-respect-to-ssl</a></p>
<p>A certificate contains</p>
<ul>
<li>public key</li>
<li>name of the issuer etc.</li>
</ul>
<p>A certificate is signed by a CA using CA's private key (other people like browsers usually already have their public keys)</p>
<hr />
<p>A certificate authority is a trusted 3rd party that does:</p>
<ul>
<li>Issues certificates</li>
<li>Confirms identity of the certificate owner</li>
<li>Provides proof that the certificate is valid</li>
</ul>
<p><img src="req.png" alt="req" /></p>
<p>Signed certificates can be used for different security protocols:</p>
<ul>
<li>HTTPS</li>
<li>SSH</li>
</ul>
<p>Nearly every modern browser checks that a server certificate is issued by a trust certificate authority. I the browser detects that the server certificate is self-signed or not signed by an approved trusted certificate authority then visitors will receive a. Warning that the server certificate cannot be trusted.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ssh"><a class="header" href="#ssh">SSH</a></h1>
<pre><code class="language-bash">ssh-keygen --help
</code></pre>
<h2 id="generate"><a class="header" href="#generate">Generate</a></h2>
<pre><code class="language-bash">ssh-keygen -t &lt;algo&gt;
</code></pre>
<p>Example private key</p>
<pre><code>-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
...
-----END OPENSSH PRIVATE KEY-----
</code></pre>
<p>example public key</p>
<pre><code>ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMpa7OiqjPnIWgkmsNjIXucypfQ4i111sA6p1937E1Yg username@user123
</code></pre>
<h2 id="compare-fingerprints-between-a-key-pair"><a class="header" href="#compare-fingerprints-between-a-key-pair">Compare fingerprints between a key pair</a></h2>
<pre><code class="language-bash">ssh-keygen -l -f &lt;privatekey_file&gt;; ssh-keygen -l -f &lt;publickey_file&gt;;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="utils"><a class="header" href="#utils">Utils</a></h1>
<p>Check if two are the same</p>
<p>cert:</p>
<pre><code>openssl x509 -modulus -noout -in cert.cer | openssl md5
</code></pre>
<ul>
<li>
<p>Encrypt or decrypt</p>
<pre><code class="language-bash">openssl pkeyutl -encrypt -in &lt;input_file&gt; -inkey &lt;key.pem&gt; -out &lt;output_file&gt;
</code></pre>
<pre><code class="language-bash">openssl pkeyutl -decrypt -in &lt;input_file&gt; -inkey &lt;key.pem&gt; -out &lt;output_file&gt;
</code></pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="code"><a class="header" href="#code">Code</a></h1>
<ol>
<li>Decode the Base64 encoding</li>
<li>Decode the PKCS8 or X509 into a <code>KeySpec</code> object</li>
<li>Create a <code>KeyFactory</code> instance.</li>
<li>Generate private or public from these 2</li>
</ol>
<h1 id="kotlin"><a class="header" href="#kotlin">Kotlin</a></h1>
<p><code>KeySpec</code> — A public or private key in encoded format. Encodings include PKCS #8, X.509????</p>
<pre><pre class="playground"><code class="language-kotlin"><span class="boring">fun main() {
</span>val pkcS8EncodedKeySpec = PKCS8EncodedKeySpec(Base64.getDecoder().decode(&quot;sdfvs331s&quot;))
<span class="boring">}</span></code></pre></pre>
<p><code>KeyFactory</code> — Generate private and public from <code>keySpec</code> key specifications</p>
<pre><pre class="playground"><code class="language-kotlin"><span class="boring">fun main() {
</span>val keyFactory = KeyFactory.getInstance(&quot;RSA&quot;)
val privateKey = keyFactory.generatePrivate(keySpec)
<span class="boring">}</span></code></pre></pre>
<p><code>Signature</code></p>
<p>Given <code>privateKey: PrivateKey</code>,</p>
<pre><pre class="playground"><code class="language-kotlin"><span class="boring">fun main() {
</span>val privateSignature = Signature.getInstance(&quot;SHA256withRSA&quot;)

privateSignature.initSign(privateKey)

privateSignature.update(&quot;payload to encrypt&quot;.encodeToByteArray())

val signature = privateSignature.sign()
<span class="boring">}</span></code></pre></pre>
<pre><code class="language-java">byte[] publicBytes = Base64.decodeBase64(publicK);
X509EncodedKeySpec keySpec = new X509EncodedKeySpec(publicBytes);
KeyFactory keyFactory = KeyFactory.getInstance(&quot;RSA&quot;);
PublicKey pubKey = keyFactory.generatePublic(keySpec);
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" charset="utf-8"></script>
        <script src="mark.min.js" charset="utf-8"></script>
        <script src="searcher.js" charset="utf-8"></script>

        <script src="clipboard.min.js" charset="utf-8"></script>
        <script src="highlight.js" charset="utf-8"></script>
        <script src="book.js" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </body>
</html>
