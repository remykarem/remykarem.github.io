<!<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="stylesheet" type="text/css" media="screen" href="main.css" /> -->
    <!-- AJAX -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Apex Charts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>

<body>

    Assessment: <select id="testName"></select>
    <br>
    Total marks: <input id="totalMarks" text="totalMarks" value=100>

    <div id="chart"></div>

    <div id="radialbar"></div>

    <select id="student"></select>
    <div id="linechart"></div>

    <textarea rows="4" cols="50">81
52
60
68
86
11
63
73
60
43
77
77
65
69
81
55
66
55
76
91
56
57
65
</textarea>
    <button>Hey</button>
    
    <script>

        $(document).ready(function () {

            var colors = ['#008FFB', '#00E396', '#FEB019', '#FF4560', '#775DD0', '#546E7A', '#26a69a', '#D10CE8'];

            var linechart = new ApexCharts(
                document.querySelector('#chart'),
                options = {
                    chart: {
                        height: 350,
                        type: 'line',
                        zoom: {
                            enabled: false
                        },
                        foreColor: '#ccc',
                        background: '#282828',
                    },
                    dataLabels: {
                        enabled: true
                    },
                    stroke: {
                        curve: 'straight'
                    },
                    series: [{
                        name: "Desktops",
                        data: [45, 41, 35, 51, 49, 62, 69, 75, 91]
                    }, 
                    {
                        name: "Deskdddtops",
                        data: [145, 141, 35, 51, 49, 62, 69, 75, 191]
                    }],
                    colors: colors,
                    grid: {
                        row: {
                            colors: ['#transparent', 'transparent'], // takes an array which will be repeated on columns
                            opacity: 0.5
                        },
                    },
                    // labels: series.monthDataSeries1.dates,
                    xaxis: {
                        categories: ['Test 1', 'Test 2', 'Test 3', 'Exam 1', 'Test 4', 'Test 5', 'Final Exam'],
                        title: {
                            text: 'Name of Assessment',
                        }
                    },
                    yaxis: {
                        min: 0,
                        max: 100,
                        tickAmount: 5,
                        title: {
                            text: 'Score (%)',
                        },
                    }
                }
            )
            linechart.render();



            $('button').click(function (e) {

                window.dataFormat = {
                    'newlineChar': '\n',
                    'splitType': '\t',
                    'numColumns': 1,
                    'withHeaders': false,
                    'withNames': false,
                };
                window.data = {
                    'assessments': [],
                    'names': [],
                };

                // Split newlines
                var lines = $('textarea').val().split(window.dataFormat['newlineChar']);

                // Determine how many columns by looking at 3rd row
                var cols = lines[2].split(window.dataFormat['splitType']);
                window.dataFormat['numColumns'] = cols.length;

                // Any headers?
                var cols = lines[0].split(window.dataFormat['splitType']);
                if (isNaN(parseFloat(cols[0]))) {
                    window.dataFormat['withHeaders'] = true;
                } else {
                    window.dataFormat['withHeaders'] = false;
                }

                // Any names?
                if (cols[0] === "Name") {
                    window.dataFormat['withNames'] = true;
                } else {
                    window.dataFormat['withNames'] = false;
                }

                console.log(window.dataFormat);

                // Charts
                var students = [];
                var headers = [];

                // Parse
                for (i = 0; i < lines.length; i++) {

                    var entries = lines[i].split(window.dataFormat['splitType']);

                    // Header issue
                    if (i === 0) {
                        // Add headers to JSON.
                        if (window.dataFormat['withHeaders']) {
                            // If there are headers
                            if (window.dataFormat['withNames']) {
                                // And if there is a name column, add only assessment names
                                for (p = 1; p < cols.length; p++) {
                                    window.data['assessments'].push(entries[p]);
                                }
                                // console.log("test names");
                                // console.log(window.data['assessments']);
                            } else {
                                // Otherwise, use given header as assessment names
                                window.data['assessments'] = entries;
                            }
                            // alert('adding headers ' + window.data['assessments']);

                            // Initialise all arrays
                            for (n = 0; n < window.data['assessments'].length; n++) {
                                window.data[window.data['assessments'][n]] = [];
                            }

                            continue;
                        } else {
                            // If no headers, create assessment names
                            // alert(cols.length);
                            var arr = [];
                            for (t = 1; t <= cols.length; t++) {
                                arr.push("Test " + t);
                            }
                            window.data['assessments'] = arr;

                            // Initialise all arrays
                            for (n = 0; n < window.data['assessments'].length; n++) {
                                window.data[window.data['assessments'][n]] = [];
                            }
                        }

                    }

                    // console.log(window.data);
                    // console.log("entries length");
                    // console.log(entries.length);

                    // For every column in a specific row
                    for (j = 0; j < entries.length; j++) {

                        // If there is a name column, add it to names and skip to next iter
                        if (j === 0 && window.dataFormat['withNames']) {
                            window.data['names'].push(entries[j]);
                            continue;
                        }
                        // console.log(j);
                        var value = parseFloat(entries[j]);
                        // console.log(value);

                        if (window.dataFormat['withNames']) {
                            window.data[window.data['assessments'][j - 1]].push(value);
                        } else {
                            window.data[window.data['assessments'][j]].push(value);
                        }
                    }

                }
                // console.log(window.data['assessments']);
                // console.log(window.data['names']);

                // Create dropdown for tests
                $("#testName").empty();
                for (k = 0; k < window.data['assessments'].length; k++) {
                    var testName = window.data['assessments'][k]
                    $("#testName").append('<option value="' + testName + '">' + testName + '</option>');
                }

                // Create dropdown for students
                $("#student").empty();
                for (q = 0; q < window.data['names'].length; q++) {
                    var studentName = window.data['names'][q]
                    $("#student").append('<option value="' + studentName + '">' + studentName + '</option>');
                }

                // Erm function here maybe?
                // Get test mark name
                var testName = data['assessments'][0];

                // Get test scores
                var testScores = window.data[testName];
                var gradeCount = [0, 0, 0, 0, 0, 0, 0, 0, 0];
                var passfail = [0, 0];

                // console.log(testName);
                // console.log(testScores);

                for (i = 0; i < testScores.length; i++) {

                    var testScore = testScores[i];

                    // Histogram
                    if (testScore < 40) {
                        gradeCount[8] += 1;
                        passfail[1] += 1;
                    } else if (testScore < 45) {
                        gradeCount[7] += 1;
                        passfail[1] += 1;
                    } else if (testScore < 50) {
                        gradeCount[6] += 1;
                        passfail[1] += 1;
                    } else if (testScore < 55) {
                        gradeCount[5] += 1;
                        passfail[0] += 1;
                    } else if (testScore < 60) {
                        gradeCount[4] += 1;
                        passfail[0] += 1;
                    } else if (testScore < 65) {
                        gradeCount[3] += 1;
                        passfail[0] += 1;
                    } else if (testScore < 70) {
                        gradeCount[2] += 1;
                        passfail[0] += 1;
                    } else if (testScore < 75) {
                        gradeCount[1] += 1;
                        passfail[0] += 1;
                    } else if (testScore <= 100) {
                        gradeCount[0] += 1;
                        passfail[0] += 1;
                    }
                }

                var passes = Math.round(passfail[0] / (passfail[0] + passfail[1]) * 100);

                console.log(passes);

                // Update chart
                chart.updateOptions({
                    series: [{
                        name: testName,
                        data: gradeCount,
                    }],
                });

                // Update pie chart
                radialbar.updateOptions({
                    series: [passes],
                });

                // Update line chart
                // linechart.updateOptions({
                //     series: [{
                //         name: "Desktops",
                //         data: [30, 41, 35, 51, 49, 62, 69, 91, 126]
                //     }],
                //     title: {
                //         text: window.data['names'][0],
                //     },
                //     xaxis: {
                //         categories: window.data['assessments'],
                //     },
                // });


            });

            $("#testName").on('change', function updateGraphs() {

                // Get test mark name
                var testName = this.value;

                // Get test scores
                var testScores = window.data[testName];
                var gradeCount = [0, 0, 0, 0, 0, 0, 0, 0, 0];
                var passfail = [0, 0];

                // console.log(testName);
                // console.log(testScores);

                for (i = 0; i < testScores.length; i++) {

                    var testScore = testScores[i];

                    // Histogram
                    if (testScore < 40) {
                        gradeCount[8] += 1;
                        passfail[1] += 1;
                    } else if (testScore < 45) {
                        gradeCount[7] += 1;
                        passfail[1] += 1;
                    } else if (testScore < 50) {
                        gradeCount[6] += 1;
                        passfail[1] += 1;
                    } else if (testScore < 55) {
                        gradeCount[5] += 1;
                        passfail[0] += 1;
                    } else if (testScore < 60) {
                        gradeCount[4] += 1;
                        passfail[0] += 1;
                    } else if (testScore < 65) {
                        gradeCount[3] += 1;
                        passfail[0] += 1;
                    } else if (testScore < 70) {
                        gradeCount[2] += 1;
                        passfail[0] += 1;
                    } else if (testScore < 75) {
                        gradeCount[1] += 1;
                        passfail[0] += 1;
                    } else if (testScore <= 100) {
                        gradeCount[0] += 1;
                        passfail[0] += 1;
                    }
                }

                var passes = Math.round(passfail[0] / (passfail[0] + passfail[1]) * 100);

                // Update chart
                chart.updateOptions({
                    series: [{
                        name: testName,
                        data: gradeCount,
                    }],
                });

                // Update pie chart
                radialbar.updateOptions({
                    series: [passes],
                });

            });



            $("#student").on('change', function updateLine() {

                var ind = window.data['names'].indexOf(this.value);
                var tests = window.data['assessments'];
                var report = [];

                for (i = 0; i < tests.length; i++) {
                    report.push(window.data[tests[i]][ind])
                }

                console.log(report);

                // Update line chart
                linechart.updateOptions({
                    series: [{
                        name: "Desktops",
                        data: report,
                    }],
                    title: {
                        text: 'Product Trends by Month',
                        align: 'left'
                    },
                    // labels: series.monthDataSeries1.dates,
                    xaxis: {
                        categories: tests,
                    },
                });
            });

        });

    </script>
</body>

</html>