# Cryptographically secure randomness

CSPRNG (cryptographically secure pseudorandom number generator), CPRNG (Cryptographic pseudo-random number generator)

The source of randomness ("**entropy**") must be cryptographically secure.

~~~admonish question
What is random even lol
~~~

CSPRNGs / sources of entropy:

1. **Cryptographic random numbers generated by the kernel: `/dev/urandom` or `/dev/random`**
  
   Entropy is obtained from multiple entropy sources and gathered in an _entropy pool_. See Apple's [Random number generation](https://support.apple.com/en-sg/guide/security/seca0c73a75b/web).

   ~~~admonish question title="What happens if there isn't enough entropy in the entropy pool?"
   The `/dev/random` will block if there isn't enough entropy to satisfy a read request.

   The `/dev/urandom` will not wait for the entropy pool to be replenished if the entropy pool is low. Instead, it will still produce random numbers using a cryptographic algorithm to ensure that the output remains sufficiently unpredictable.
   ~~~

   ~~~admonish tip
   Just use `/dev/urandom`.
   
   The "u" in `/dev/urandom` stands for "unlimited" or "unblocking".
   ~~~

   ~~~admonish example title="*nix"
   ```bash
   head -c10 /dev/urandom
   ```
   ~~~

   ~~~admonish example title="Python"
   ```python
   >>> import os
   >>> os.urandom(10)
   b'\xea\xdc\x11\xe3-\x03\xb7\x18M\xb2'
   ```
   ~~~

   ~~~admonish example title="JVM"
   ```kotlin
   import java.security.SecureRandom

   val secureRandom = SecureRandom.getInstance("NativePRNG")
   val randomInt = secureRandom.nextInt()
   ```
   ~~~

   See also this article on [Myths about /dev/urandom](https://www.2uo.de/myths-about-urandom/).

2. **Libraries (eg. libsodium)**

3. **Unknown**

   ~~~admonish example title="OpenSSL"
   ```bash
   openssl rand 10
   ```
   ~~~

   ~~~admonish example title="JavaScript"
   ```javascript
   const array = new Uint32Array(10);
   window.crypto.getRandomValues(array);
   ```
   ~~~

   ~~~admonish example title="JVM"
   ```kotlin
   import java.security.SecureRandom

   val secureRandom = SecureRandom.getInstance("SHA1PRNG")
   val randomInt = secureRandom.nextInt()
   ```
   ~~~

   ~~~admonish example title="Python"
   ```python
   >>> import secrets
   >>> secrets.token_bytes(16)
   ```
   ~~~


~~~admonish warning title="Non-cryptographically secure sources"
* Random number generators from math libraries 

   Eg. `Math.random()` in JavaScript

* UUID
    
    Some UUID implementations might not be cryptographically secure. Meaning, the _source of entropy_ might not be cryptographically secure.

    [RFC 4122 Section 6](https://datatracker.ietf.org/doc/html/rfc4122#section-6) says that UUID implementations might not use a cryptographically secure random number generator.

    A StackOverflow post [Using V4 UUID for authentication](https://security.stackexchange.com/a/157277) points to an example of a UUIDv4 implementation that uses a non-cryptographic PRNG.

    Note that UUIDv4's main goal is to generate unique identifiers, not unpredictability.
~~~
